{"title":"connected-react-router","uid":"3a1de7864b72f88f991d2ad903723f46","slug":"connected-react-router","date":"2021-04-06T14:27:28.294Z","updated":"2021-04-06T14:51:00.207Z","comments":true,"path":"api/articles/connected-react-router.json","keywords":null,"cover":"http://img-blog.csdnimg.cn/20200815152729473.png","content":"<h2 id=\"index-js\"><a href=\"#index-js\" class=\"headerlink\" title=\"index.js\"></a>index.js</h2><span id=\"more\"></span>\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> routerMiddlware <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./routerMiddlware&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> connectRouter <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./connectRouter&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> push <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./push&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ConnectedRouter <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./ConnectedRouter&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; routerMiddlware, connectRouter, push, ConnectedRouter &#125;;</span><br></pre></td></tr></table></figure>\n\n<!-- more -->\n\n<h2 id=\"constants\"><a href=\"#constants\" class=\"headerlink\" title=\"constants\"></a>constants</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> CALL_HISTORY_METHOD = <span class=\"string\">&#x27;@@router/CALL_HISTORY_METHOD&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> LOCATION_CHANGE = <span class=\"string\">&#x27;@@router/LOCATION_CHANGE&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"ConnectedRouter-js\"><a href=\"#ConnectedRouter-js\" class=\"headerlink\" title=\"ConnectedRouter.js\"></a>ConnectedRouter.js</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; ReactReduxContext &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-redux&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Route &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-router&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; LOCATION_CHANGE &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./constants&#x27;</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConnectedRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> contextType = ReactReduxContext;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">constructor</span>(<span class=\"params\">props</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">super</span>(props);</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.state = &#123;&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentDidMount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// location 新的路径</span></span><br><span class=\"line\">    <span class=\"comment\">// action 新的动作 POP PUSH</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.unlistener = <span class=\"built_in\">this</span>.props.history.listen(<span class=\"function\">(<span class=\"params\">location, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.context.store.dispatch(&#123;</span><br><span class=\"line\">        type: LOCATION_CHANGE,</span><br><span class=\"line\">        payload: &#123; location, action &#125;,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">componentWillUnmount</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.unlistener();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">render</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; history, children &#125; = <span class=\"built_in\">this</span>.props;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;history&#125;</span>&gt;</span>&#123;children&#125;<span class=\"tag\">&lt;/<span class=\"name\">Route</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> ConnectedRouter;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"connectRouter-js\"><a href=\"#connectRouter-js\" class=\"headerlink\" title=\"connectRouter.js\"></a>connectRouter.js</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; LOCATION_CHANGE &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./constants&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line import/no-anonymous-default-export</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">history</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> initialState = &#123; <span class=\"attr\">action</span>: history.action, <span class=\"attr\">location</span>: history.location &#125;;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">state = initialState, action</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> LOCATION_CHANGE:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> action.payload;</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"push\"><a href=\"#push\" class=\"headerlink\" title=\"push\"></a>push</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; CALL_HISTORY_METHOD &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./constants&#x27;</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    type: CALL_HISTORY_METHOD,</span><br><span class=\"line\">    payload: &#123;</span><br><span class=\"line\">      method: <span class=\"string\">&#x27;push&#x27;</span>,</span><br><span class=\"line\">      path,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> push;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"routerMiddleware-js\"><a href=\"#routerMiddleware-js\" class=\"headerlink\" title=\"routerMiddleware.js\"></a>routerMiddleware.js</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; CALL_HISTORY_METHOD &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./constants&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line import/no-anonymous-default-export</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">history</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">&#123; dispatch, getState &#125;</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (action.type === CALL_HISTORY_METHOD) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> &#123; method, path &#125; = action.payload;</span><br><span class=\"line\">      history[method](path);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","feature":null,"text":"index.js 12345import routerMiddlware from &#x27;./routerMiddlware&#x27;;import connectRouter from &#x27;./connectRouter&#x27;;import push fr...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"React","slug":"React","count":7,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":7,"path":"api/tags/React.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#index-js\"><span class=\"toc-text\">index.js</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#constants\"><span class=\"toc-text\">constants</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#ConnectedRouter-js\"><span class=\"toc-text\">ConnectedRouter.js</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#connectRouter-js\"><span class=\"toc-text\">connectRouter.js</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#push\"><span class=\"toc-text\">push</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#routerMiddleware-js\"><span class=\"toc-text\">routerMiddleware.js</span></a></li></ol>","author":{"name":"麦当","avatar":"http://image.vulpix.top/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210326214030.jpg","link":""},"mapped":true,"prev_post":{"title":"proxy 基础学习","uid":"764ea20144bdcb36de34ee7af78c0567","slug":"proxy","date":"2021-04-06T14:27:28.313Z","updated":"2021-04-06T14:51:47.305Z","comments":true,"path":"api/articles/proxy.json","keywords":null,"cover":"http://img-blog.csdnimg.cn/20200807160832237.jpg","text":"代理基础什么是代理 代理是目标对象的抽象，类似于 c++的指针，可以用作目标的替身，又独立目标之外。 1234567891011const target = &#123; id: &#x27;target&#x27;,&#125;;const handler = &#123;&#...","link":"","photos":[],"count_time":{"symbolsCount":"8.1k","symbolsTime":"7 mins."},"categories":[{"name":"JavaScript","slug":"JavaScript","count":2,"path":"api/categories/JavaScript.json"}],"tags":[{"name":"JavaScript","slug":"JavaScript","count":2,"path":"api/tags/JavaScript.json"}],"author":{"name":"麦当","avatar":"http://image.vulpix.top/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210326214030.jpg","link":""}},"next_post":{}}