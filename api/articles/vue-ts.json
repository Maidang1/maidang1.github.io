{"title":"用typescript 增强vuex的类型","uid":"bbd6549d987a6d65496504fcf8d06748","slug":"vue-ts","date":"2021-04-14T02:36:02.000Z","updated":"2021-04-14T02:36:02.760Z","comments":true,"path":"api/articles/vue-ts.json","keywords":null,"cover":"http://img-blog.csdnimg.cn/20200716163610402.jpg","content":"<h2 id=\"index-ts\"><a href=\"#index-ts\" class=\"headerlink\" title=\"index.ts\"></a>index.ts</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; createStore &#125; from &#39;vuex&#39;;\nimport &#123; modules &#125; from &#39;.&#x2F;modules&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;modules&#x2F;user&#x2F;store&#39;;\ntype State &#x3D; &#123;\n  user: userState,\n&#125;;\n\nconst store &#x3D;\n  createStore &lt;\n  State &gt;\n  &#123;\n    modules,\n  &#125;;\nexport &#123; State &#125;;\nexport default store;</code></pre>\n\n<h2 id=\"modules-ts\"><a href=\"#modules-ts\" class=\"headerlink\" title=\"modules.ts\"></a>modules.ts</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import user from &#39;.&#x2F;modules&#x2F;user&#39;;\nimport wechat from &#39;.&#x2F;modules&#x2F;wechat&#39;;\nconst modules &#x3D; &#123;\n  user,\n  wechat,\n&#125;;\n\nexport &#123; modules &#125;;</code></pre>\n\n<h2 id=\"utils-ts\"><a href=\"#utils-ts\" class=\"headerlink\" title=\"utils.ts\"></a>utils.ts</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; &#123;\n&#x2F;&#x2F;     &quot;user&#x2F;isLogin&quot;:number\n&#x2F;&#x2F; &#125;\n&#x2F;**\n * 1.取到每一个 namespace 中的核心的getters\n * 2.user&#x2F;isLogin\n * 3.user.isLogin的returnType取出来\n *&#x2F;\nimport &#123; modules &#125; from &#39;.&#x2F;modules&#39;;\ntype GetGetter&lt;Module&gt; &#x3D; Module extends &#123; getters: infer G &#125; ? G : unknown;\n\ntype GetGetters&lt;Modules&gt; &#x3D; &#123;\n  [K in keyof Modules]: GetGetter&lt;Modules[K]&gt;;\n&#125;;\n\ntype YdGettes &#x3D; GetGetters&lt;typeof modules&gt;;\ntype Addprefix&lt;P, K&gt; &#x3D; &#96;$&#123;P &amp; string&#125;&#x2F;$&#123;K &amp; string&#125;&#96;;\ntype GetSpliceKey&lt;P, Module&gt; &#x3D; Addprefix&lt;P, keyof Module&gt;;\n\ntype GetSpliceKeys&lt;Modules&gt; &#x3D; &#123;\n  [K in keyof Modules]: GetSpliceKey&lt;K, Modules[K]&gt;;\n&#125;[keyof Modules];\n\n&#x2F;&#x2F;  type xx &#x3D; GetSpliceKeys&lt;YdGettes&gt;;\ntype GetFunc&lt;T, A, B&gt; &#x3D; T[A &amp; keyof T][B &amp; keyof T[A &amp; keyof T]];\n\ntype GetSpliceObj&lt;T&gt; &#x3D; &#123;\n  [K in GetSpliceKeys&lt;T&gt;]: K extends &#96;$&#123;infer A&#125;&#x2F;$&#123;infer B&#125;&#96;\n    ? GetFunc&lt;T, A, B&gt;\n    : unknown;\n&#125;;\n\ntype ModuleGeters &#x3D; GetSpliceObj&lt;YdGettes&gt;;\ntype Getters &#x3D; &#123;\n  [K in keyof ModuleGeters]: ReturnType&lt;ModuleGeters[K]&gt;;\n&#125;;\nexport &#123; Getters &#125;;\n\n</code></pre>\n\n<h2 id=\"modules-user\"><a href=\"#modules-user\" class=\"headerlink\" title=\"modules/user\"></a>modules/user</h2><h3 id=\"action-ts\"><a href=\"#action-ts\" class=\"headerlink\" title=\"action.ts\"></a>action.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; ActionContext &#125; from &#39;vuex&#39;;\nimport &#123; GET_DATA &#125; from &#39;.&#x2F;constant&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nexport default &#123;\n  [GET_DATA](&#123; commit &#125;: ActionContext&lt;userState, unknown&gt;): void &#123;\n    console.log(&#39;action执行成功&#39;);\n    setTimeout(() &#x3D;&gt; &#123;\n      const payload &#x3D; false;\n      commit(GET_DATA, payload);\n    &#125;, 2000);\n  &#125;,\n&#125;;</code></pre>\n\n<h3 id=\"constant-ts\"><a href=\"#constant-ts\" class=\"headerlink\" title=\"constant.ts\"></a>constant.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const GET_DATA &#x3D; &#39;GET_DATA&#39;;\nexport &#123; GET_DATA &#125;;</code></pre>\n\n<h3 id=\"getters-ts\"><a href=\"#getters-ts\" class=\"headerlink\" title=\"getters.ts\"></a>getters.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nconst moduleGetters &#x3D; &#123;\n  isLogin: (state: userState): string &#x3D;&gt; &#123;\n    return &#96;🏮$&#123;state.loading&#125;&#96;;\n  &#125;,\n&#125;;\nexport default moduleGetters;</code></pre>\n\n<h3 id=\"index-ts-1\"><a href=\"#index-ts-1\" class=\"headerlink\" title=\"index.ts\"></a>index.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; createState &#125; from &#39;.&#x2F;store&#39;;\nimport getters from &#39;.&#x2F;getters&#39;;\nimport mutations from &#39;.&#x2F;mutations&#39;;\nimport actions from &#39;.&#x2F;actions&#39;;\n\nconst state &#x3D; createState();\nexport default &#123;\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions,\n&#125;;</code></pre>\n\n<h3 id=\"mutations-ts\"><a href=\"#mutations-ts\" class=\"headerlink\" title=\"mutations.ts\"></a>mutations.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; GET_DATA &#125; from &#39;.&#x2F;constant&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nconst mutations &#x3D; &#123;\n  [GET_DATA](state: userState, payload: boolean): void &#123;\n    console.log(&#39;mutations执行成功&#39;);\n    state.loading &#x3D; payload;\n  &#125;,\n&#125;;\nexport default mutations;</code></pre>\n\n<h3 id=\"store-ts\"><a href=\"#store-ts\" class=\"headerlink\" title=\"store.ts\"></a>store.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">export const createState &#x3D; () &#x3D;&gt; &#123;\n  const store &#x3D; &#123;\n    loading: true,\n  &#125;;\n  return store;\n&#125;;\n&#x2F;&#x2F;类型推导\nexport type userState &#x3D; ReturnType&lt;typeof createState&gt;;</code></pre>\n\n<h2 id=\"hooks\"><a href=\"#hooks\" class=\"headerlink\" title=\"hooks\"></a>hooks</h2><h3 id=\"index-ts-2\"><a href=\"#index-ts-2\" class=\"headerlink\" title=\"index.ts\"></a>index.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">export &#123; useYdStore &#125; from &#39;.&#x2F;use-store&#39;;</code></pre>\n\n<h3 id=\"use-store-ts\"><a href=\"#use-store-ts\" class=\"headerlink\" title=\"use-store.ts\"></a>use-store.ts</h3><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; useStore &#125; from &#39;vuex&#39;;\nimport &#123; State &#125; from &#39;..&#x2F;store&#39;;\nimport &#123; Getters &#125; from &#39;..&#x2F;store&#x2F;utils&#39;;\n\ninterface IUserYdStore &#123;\n  state: State;\n  getters: Getters;\n&#125;\nconst useYdStore &#x3D; (): IUserYdStore &#x3D;&gt; &#123;\n  const &#123; state, getters &#125;: IUserYdStore &#x3D; useStore&lt;State&gt;();\n  return &#123; state, getters &#125;;\n&#125;;\nexport &#123; useYdStore &#125;;\nexport default useYdStore;\n</code></pre>\n","feature":null,"text":"index.tsimport &#123; createStore &#125; from &#39;vuex&#39;; import &#123; modules &#125; from &#39;.&#x2F;modules&#39;; import &#123; user...","link":"","photos":[],"count_time":{"symbolsCount":"4.3k","symbolsTime":"4 mins."},"categories":[{"name":"vue","slug":"vue","count":3,"path":"api/categories/vue.json"}],"tags":[{"name":"typescript","slug":"typescript","count":1,"path":"api/tags/typescript.json"},{"name":"vuex","slug":"vuex","count":2,"path":"api/tags/vuex.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#index-ts\"><span class=\"toc-text\">index.ts</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#modules-ts\"><span class=\"toc-text\">modules.ts</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#utils-ts\"><span class=\"toc-text\">utils.ts</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#modules-user\"><span class=\"toc-text\">modules&#x2F;user</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#action-ts\"><span class=\"toc-text\">action.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#constant-ts\"><span class=\"toc-text\">constant.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#getters-ts\"><span class=\"toc-text\">getters.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#index-ts-1\"><span class=\"toc-text\">index.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#mutations-ts\"><span class=\"toc-text\">mutations.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#store-ts\"><span class=\"toc-text\">store.ts</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#hooks\"><span class=\"toc-text\">hooks</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#index-ts-2\"><span class=\"toc-text\">index.ts</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#use-store-ts\"><span class=\"toc-text\">use-store.ts</span></a></li></ol></li></ol>","author":{"name":"麦当","avatar":"https://cdn.jsdelivr.net/gh/Maidang1/image//image/avatar.jpg","link":""},"mapped":true,"prev_post":{},"next_post":{"title":"css 好看的案例","uid":"d7f18c2655e3f93631b257b366acd0c3","slug":"cssExample","date":"2021-04-11T10:15:28.048Z","updated":"2021-04-11T10:37:58.534Z","comments":true,"path":"api/articles/cssExample.json","keywords":null,"cover":"https://cdn.jsdelivr.net/gh/Maidang1/image//image/beach-2089936_1920.jpg","text":"渐变 &lt;body&gt; &lt;div class&#x3D;&quot;box&quot;&gt;&lt;h2&gt;Gradient&lt;&#x2F;h2&gt;&lt;&#x2F;div&gt; &lt;div class&#x3D;&quot;box&quot;...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"css","slug":"css","count":1,"path":"api/categories/css.json"}],"tags":[{"name":"css","slug":"css","count":1,"path":"api/tags/css.json"}],"author":{"name":"麦当","avatar":"https://cdn.jsdelivr.net/gh/Maidang1/image//image/avatar.jpg","link":""}}}