[{"id":"bbd6549d987a6d65496504fcf8d06748","title":"ç”¨typescript å¢å¼ºvuexçš„ç±»å‹","content":"index.tsimport &#123; createStore &#125; from &#39;vuex&#39;;\nimport &#123; modules &#125; from &#39;.&#x2F;modules&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;modules&#x2F;user&#x2F;store&#39;;\ntype State &#x3D; &#123;\n  user: userState,\n&#125;;\n\nconst store &#x3D;\n  createStore &lt;\n  State &gt;\n  &#123;\n    modules,\n  &#125;;\nexport &#123; State &#125;;\nexport default store;\n\nmodules.tsimport user from &#39;.&#x2F;modules&#x2F;user&#39;;\nimport wechat from &#39;.&#x2F;modules&#x2F;wechat&#39;;\nconst modules &#x3D; &#123;\n  user,\n  wechat,\n&#125;;\n\nexport &#123; modules &#125;;\n\nutils.ts&#x2F;&#x2F; &#123;\n&#x2F;&#x2F;     &quot;user&#x2F;isLogin&quot;:number\n&#x2F;&#x2F; &#125;\n&#x2F;**\n * 1.å–åˆ°æ¯ä¸€ä¸ª namespace ä¸­çš„æ ¸å¿ƒçš„getters\n * 2.user&#x2F;isLogin\n * 3.user.isLoginçš„returnTypeå–å‡ºæ¥\n *&#x2F;\nimport &#123; modules &#125; from &#39;.&#x2F;modules&#39;;\ntype GetGetter&lt;Module&gt; &#x3D; Module extends &#123; getters: infer G &#125; ? G : unknown;\n\ntype GetGetters&lt;Modules&gt; &#x3D; &#123;\n  [K in keyof Modules]: GetGetter&lt;Modules[K]&gt;;\n&#125;;\n\ntype YdGettes &#x3D; GetGetters&lt;typeof modules&gt;;\ntype Addprefix&lt;P, K&gt; &#x3D; &#96;$&#123;P &amp; string&#125;&#x2F;$&#123;K &amp; string&#125;&#96;;\ntype GetSpliceKey&lt;P, Module&gt; &#x3D; Addprefix&lt;P, keyof Module&gt;;\n\ntype GetSpliceKeys&lt;Modules&gt; &#x3D; &#123;\n  [K in keyof Modules]: GetSpliceKey&lt;K, Modules[K]&gt;;\n&#125;[keyof Modules];\n\n&#x2F;&#x2F;  type xx &#x3D; GetSpliceKeys&lt;YdGettes&gt;;\ntype GetFunc&lt;T, A, B&gt; &#x3D; T[A &amp; keyof T][B &amp; keyof T[A &amp; keyof T]];\n\ntype GetSpliceObj&lt;T&gt; &#x3D; &#123;\n  [K in GetSpliceKeys&lt;T&gt;]: K extends &#96;$&#123;infer A&#125;&#x2F;$&#123;infer B&#125;&#96;\n    ? GetFunc&lt;T, A, B&gt;\n    : unknown;\n&#125;;\n\ntype ModuleGeters &#x3D; GetSpliceObj&lt;YdGettes&gt;;\ntype Getters &#x3D; &#123;\n  [K in keyof ModuleGeters]: ReturnType&lt;ModuleGeters[K]&gt;;\n&#125;;\nexport &#123; Getters &#125;;\n\n\n\nmodules/useraction.tsimport &#123; ActionContext &#125; from &#39;vuex&#39;;\nimport &#123; GET_DATA &#125; from &#39;.&#x2F;constant&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nexport default &#123;\n  [GET_DATA](&#123; commit &#125;: ActionContext&lt;userState, unknown&gt;): void &#123;\n    console.log(&#39;actionæ‰§è¡ŒæˆåŠŸ&#39;);\n    setTimeout(() &#x3D;&gt; &#123;\n      const payload &#x3D; false;\n      commit(GET_DATA, payload);\n    &#125;, 2000);\n  &#125;,\n&#125;;\n\nconstant.tsconst GET_DATA &#x3D; &#39;GET_DATA&#39;;\nexport &#123; GET_DATA &#125;;\n\ngetters.tsimport &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nconst moduleGetters &#x3D; &#123;\n  isLogin: (state: userState): string &#x3D;&gt; &#123;\n    return &#96;ğŸ®$&#123;state.loading&#125;&#96;;\n  &#125;,\n&#125;;\nexport default moduleGetters;\n\nindex.tsimport &#123; createState &#125; from &#39;.&#x2F;store&#39;;\nimport getters from &#39;.&#x2F;getters&#39;;\nimport mutations from &#39;.&#x2F;mutations&#39;;\nimport actions from &#39;.&#x2F;actions&#39;;\n\nconst state &#x3D; createState();\nexport default &#123;\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions,\n&#125;;\n\nmutations.tsimport &#123; GET_DATA &#125; from &#39;.&#x2F;constant&#39;;\nimport &#123; userState &#125; from &#39;.&#x2F;store&#39;;\n\nconst mutations &#x3D; &#123;\n  [GET_DATA](state: userState, payload: boolean): void &#123;\n    console.log(&#39;mutationsæ‰§è¡ŒæˆåŠŸ&#39;);\n    state.loading &#x3D; payload;\n  &#125;,\n&#125;;\nexport default mutations;\n\nstore.tsexport const createState &#x3D; () &#x3D;&gt; &#123;\n  const store &#x3D; &#123;\n    loading: true,\n  &#125;;\n  return store;\n&#125;;\n&#x2F;&#x2F;ç±»å‹æ¨å¯¼\nexport type userState &#x3D; ReturnType&lt;typeof createState&gt;;\n\nhooksindex.tsexport &#123; useYdStore &#125; from &#39;.&#x2F;use-store&#39;;\n\nuse-store.tsimport &#123; useStore &#125; from &#39;vuex&#39;;\nimport &#123; State &#125; from &#39;..&#x2F;store&#39;;\nimport &#123; Getters &#125; from &#39;..&#x2F;store&#x2F;utils&#39;;\n\ninterface IUserYdStore &#123;\n  state: State;\n  getters: Getters;\n&#125;\nconst useYdStore &#x3D; (): IUserYdStore &#x3D;&gt; &#123;\n  const &#123; state, getters &#125;: IUserYdStore &#x3D; useStore&lt;State&gt;();\n  return &#123; state, getters &#125;;\n&#125;;\nexport &#123; useYdStore &#125;;\nexport default useYdStore;\n\n","slug":"vue-ts","date":"2021-04-14T02:36:02.000Z","categories_index":"vue","tags_index":"typescript,vuex","author_index":"éº¦å½“"},{"id":"d7f18c2655e3f93631b257b366acd0c3","title":"css å¥½çœ‹çš„æ¡ˆä¾‹","content":"æ¸å˜\n&lt;body&gt;\n  &lt;div class&#x3D;&quot;box&quot;&gt;&lt;h2&gt;Gradient&lt;&#x2F;h2&gt;&lt;&#x2F;div&gt;\n  &lt;div class&#x3D;&quot;box&quot;&gt;&lt;h2&gt;box&lt;&#x2F;h2&gt;&lt;&#x2F;div&gt;\n  &lt;div class&#x3D;&quot;box&quot;&gt;&lt;h2&gt;Shadow&lt;&#x2F;h2&gt;&lt;&#x2F;div&gt;\n&lt;&#x2F;body&gt;\n\nbody &#123;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: wrap;\n  min-height: 100vh;\n&#125;\n.box &#123;\n  position: relative;\n  width: 300px;\n  height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 30px;\n&#125;\n.box::before &#123;\n  content: &#39;&#39;;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  filter: blur(25px);\n  transform: translateY(30px) scale(0.9);\n&#125;\n.box:nth-child(1),\n.box:nth-child(1)::before &#123;\n  background: linear-gradient(135deg, #f403d1, #64b5f6);\n&#125;\n.box:nth-child(2),\n.box:nth-child(2)::before &#123;\n  background: linear-gradient(135deg, #ffec61, #f321d7);\n&#125;\n.box:nth-child(3),\n.box:nth-child(3)::before &#123;\n  background: linear-gradient(135deg, #24ff72, #2196f3);\n&#125;\n.box h2 &#123;\n  position: relative;\n  z-index: 1;\n  color: #fff;\n  font-size: 3em;\n&#125;\n","slug":"cssExample","date":"2021-04-11T10:15:28.048Z","categories_index":"css","tags_index":"css","author_index":"éº¦å½“"},{"id":"0d342afe6af4aff548d2b83f7ab3c19b","title":"Reactå“²å­¦","content":"æµè§ˆå™¨è¿è¡Œç¯å¢ƒjs è¿è¡Œ ---&gt; v8&#x2F;quickJs\næµè§ˆå™¨ js&#x2F;html&#x2F;css &#x3D;&#x3D;&#x3D;&#x3D; æ¡†æ¶\nReact UIæ¡†æ¶ ----&gt; å¿«é€Ÿå“åº” é…åˆæµè§ˆå™¨çš„ç‰¹æ€§å¼€å‘ ä¸æ˜¯å‹æ¦¨æµè§ˆå™¨æ€§èƒ½\n\nç¯å¢ƒç‰¹ç‚¹é…åˆæ¡†æ¶\næ¡†æ¶æœ‰ä¸ªè¿è¡Œæ—¶ç¯å¢ƒ æ ¹æ®ä¸åŒçš„ç¯å¢ƒç”Ÿæˆä¸åŒçš„æè¿°è¯­è¨€ æ”¾è¿›ä¸åŒçš„å®¹å™¨ä¸­\nç„¶åé…åˆç”Ÿæˆä¸åŒçš„ç¨‹åºï¼Œ é…åˆä¸åŒçš„æ“ä½œç³»ç»Ÿ\n\næµè§ˆå™¨æµè§ˆå™¨è¿›ç¨‹\n\nç½‘ç»œçº¿ç¨‹ (dns tcp ip è·¨åŸŸ mime)\nUI çº¿ç¨‹\næ–‡ä»¶è¯»å†™(store)çº¿ç¨‹\n\næ¸²æŸ“è¿›ç¨‹\n\nåˆæˆçº¿ç¨‹\nä¸»çº¿ç¨‹ (js æ‰§è¡Œ html è§£æ åƒåœ¾å›æ”¶)\ntile work çº¿ç¨‹\n\nGPU è¿›ç¨‹\n\nGPU çº¿ç¨‹ (ç»˜å›¾)\n\næ¸²æŸ“\nèµ„æºç»è¿‡ç½‘ç»œçº¿ç¨‹åŠ è½½ä¹‹å é€ç»™åˆæˆçº¿ç¨‹\nä¸€å¸§è¿›è¡Œçš„æ“ä½œrequestAnimationFrame(ä¸Šä¸€å¸§ç»‘å®šçš„å›è°ƒ)Parse HTML (DOM æ ‘)Receive Styles ï¼ˆCSSOMï¼‰LayoutUI (çœŸæ­£è¦å±•ç¤ºçš„æ ‘ æ¯ä¸ªèŠ‚ç‚¹æœ‰ç›¸åº”çš„å±æ€§ å®½é«˜ æ²¡æœ‰å±‚çº§)Update Layer Tree å±‚å ä¸Šä¸‹æ–‡ Z è½´(åˆ†å±‚)Paint ç»˜åˆ¶è®°å½•è¡¨ (Skia Graphics Library)\n\nComposite (åˆæˆé˜¶æ®µ)\nå…‰æ …åŒ– (åˆ‡å—) CPU(å‡ ä½•æ•°æ®) ===&gt; GPU(åƒç´ ç‚¹ä¿¡æ¯ç»“åˆ) å­˜å‚¨\nåˆæˆçº¿ç¨‹è¿”å›ä¿¡æ¯\n{(å‡ ä½•ä¿¡æ¯): (åƒç´ ä¿¡æ¯ å†…å­˜åœ°å€) åŒæ—¶æ ‡è®°éå¿«é€Ÿæ»šåŠ¨åŒºåŸŸ(æ³¨å†Œäº‹ä»¶)}\nä¸‹æ¬¡æ¸²æŸ“ åˆæˆçº¿ç¨‹ (ç‚¹å‡»çš„é¼ æ ‡æœ‰ä½ç½®å’Œéå¿«é€Ÿæ»šåŠ¨åŒºåŸŸä½œæ¯”è¾ƒï¼Œä¸æ˜¯éå¿«é€Ÿæ»šåŠ¨åŒºåŸŸä½œæ¯”è¾ƒ ä¸éœ€è¦ä¸»çº¿ç¨‹å‚ä¸æœ¬æ¬¡æ›´æ–°)\nrequestidleCallback æœ¬çœŸæ‰§è¡Œ(æœ‰æ—¶é—´å°±æ‰§è¡Œ æ²¡æ—¶é—´å°±å»¶åæ‰§è¡Œ)\nreact &lt; 17 äº‹ä»¶ç»‘å®šåœ¨ document æ‰€ä»¥æ¯æ¬¡éƒ½ä¼šæœ‰ä¸»çº¿ç¨‹react &gt; 17 è¿›è¡Œäº†æ›´åŠ ç»†è‡´çš„äº‹ä»¶ç»‘å®š\n========&gt; å¦‚ä½•è®©æ¡†æ¶æ›´åŠ å¥‘åˆæµè§ˆå™¨çš„ç‰¹ç‚¹\né•¿ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡\nä¸­æ–­\nreactâ€”-&gt; js\nç®¡ç†æ•°æ®\njs åç¨‹ (yeild) ä»»åŠ¡ä¸­æ–­\nrequestAnimitionFrame ===&gt; requestidleCallback\nrect ä»»åŠ¡ç»´åº¦ UI\nç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„ fiber ç±»ä¼¼äº PCB è®°å½•ä¸­æ–­çš„çŠ¶æ€\nreact å¥‘åˆæµè§ˆå™¨æ¡†æ¶ ====&gt;v8(js å¼•æ“) å¯ä»¥åšè·¨ç«¯åº”ç”¨\nv8 quickjs ====&gt; libuv(äº‹ä»¶è°ƒåº¦) skia å¼•æ“\nflutter(dart) ====&gt; skiaæµè§ˆå™¨ js(canvas)====&gt; skia\nç”¨æˆ·å¡é¡¿ æ¸²æŸ“é¢‘ç‡ ====&gt; æ‰§è¡Œæ—¶é—´å°‘\ndom é•¿ä»»åŠ¡ js ====&gt; å¯ä¸­æ–­ ====&gt; yeild PCB\né•¿ä»»åŠ¡ï¼šæ¯ä¸€å¸§ dom çš„åˆ é™¤å’Œæ’å…¥æ“ä½œ éå†dom çš„åˆ›å»º æ’å…¥ éå† ç¼–ç¨‹å¯ä¸­æ–­çš„ç»“æ„\ndom æ ‘ç»“æ„ ä¿ç•™ç»“æ„çš„å…³ç³»ä¸­æ–­èŠ‚ç‚¹å’Œå…¶ä»–èŠ‚ç‚¹çš„å…³è”å…³ç³» ç»´æŠ¤ä¸€ä¸ª fiber èŠ‚ç‚¹çš„ä¿¡æ¯å³å¯\nå°ä»»åŠ¡:\nå¯ä»¥æ¢å¤çš„æ•°æ®ç»“æ„ï¼ˆfiberï¼‰\nrender ===&gt; æŸ¥æ‰¾å¤šä»»åŠ¡è°ƒåº¦ï¼ˆä¼˜å…ˆçº§è°ƒåº¦ï¼‰=====&gt; schedule æ¯æ¬¡æœ€å¤šæ‰§è¡Œ 5ms\nrender(åŒæ­¥)\\setState\\foreUpdate\nfiber æ›´æ–° æ”¶é›†æ‰€æœ‰çš„ä»»åŠ¡æ¯æ¬¡åšçš„å°ä»»åŠ¡ åˆ›å»ºæœ¬èŠ‚ç‚¹çš„ dom ç»“æ„ åˆ›å»ºæœ¬èŠ‚ç‚¹çš„å­ fiberï¼ˆä¿ç•™äº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼‰å®ç°äº†å¯ä¸­æ–­æ›´æ–°\n","slug":"reactå“²å­¦","date":"2021-04-07T14:08:51.000Z","categories_index":"React","tags_index":"React","author_index":"éº¦å½“"},{"id":"159e1d8888631750dd50b9032a4b1226","title":"svelte","content":"SvelteVue.min.js\nVue.runtime.js (dom diff è™šæ‹Ÿ dom) è¿è¡Œæ—¶\nReact Vue\nè™šæ‹Ÿ dom ---&gt; dom diff\n\næå‡æ€§èƒ½?\nhtml è¾“å‡º domReady æå‰\n\né‡ç»˜ é‡æ’(é‡æ–°å¸ƒå±€)\nFID FP FCP LCP\n\nJQuery æ²¡æœ‰å“åº”å¼\n\nSvelte ç›¸å½“äº store + å“åº”å¼ + JQuery\n\nè‡ªå·±å¯¹äº Vue, React, Svelte çš„ç†è§£ç°åœ¨çš„æ¡†æ¶éƒ½æ˜¯åŸºäºå“åº”å¼çš„ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬ä¸è¦å…³å¿ƒå¯¹äºDOMçš„æ“ä½œ\næˆ‘ä»¬åªéœ€è¦æ³¨é‡äºæ•°æ®é©±åŠ¨è§†å›¾å³å¯ã€‚æ‰€ä»¥Vue, Reactå°±æ˜¯ä¸“æ³¨äºäºæ•°æ®å’Œ\nè§†å›¾ã€‚è¿½æ±‚çš„æè‡´å°±æ˜¯è¿½æ±‚æœ€å°çš„DOMæ“ä½œï¼Œä¸ºæ­¤è¯ç”Ÿå‡ºäº†å¤§åé¼é¼çš„DOM DIFF\nç®—æ³•ã€‚ é€šè¿‡è™šæ‹ŸDOM æ¥å¯»æ‰¾æœ€å°çš„å…ƒç´ æ›´æ–°ã€‚ä¸ºæ­¤å‡ºç°äº†ä¸€å¤§æ¨çš„ç¼–è¯‘ï¼Œè°ƒåº¦\næ›´æ–°ã€‚Svelteå¹¶æ²¡æœ‰è™šæ‹ŸDOM å»ç›´æ¥è·Ÿè¸ªæœ€å°çš„å…ƒç´ èŠ‚ç‚¹ã€‚é¿å…äº†è™šæ‹ŸDOMçš„\nå¤§é‡æ¯”å¯¹ ç›¸å½“äºä¸€ä¸ªç¼–è¯‘å™¨\n\nä¼˜ç‚¹\nç¼–è¯‘å‡ºæ¥çš„ä»£ç å° çŠ¶æ€ç®¡ç† å“åº”å¼\nTs Scoped Style\næ²¡æœ‰è™šæ‹Ÿ dom dom diff\n\nç¼ºç‚¹\nç»„ä»¶åº“ è·¯ç”± å°‘\n\n","slug":"svelte","date":"2021-04-07T12:07:51.000Z","categories_index":"JavaScript","tags_index":"svelte","author_index":"éº¦å½“"},{"id":"e292dba6baac8421f1f811c59a127952","title":"JavaScriptåŸºç¡€çŸ¥è¯†","content":"ArrayBuffer\nç‰¹æ®Šçš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥åˆ†é…æŒ‡å®šå¤§å°çš„å­—èŠ‚ç©ºé—´ï¼Œç©ºé—´åˆ†é…ä¹‹åä¸åœ¨å˜åŒ– å¯ä»¥ç”¨ slice()æ–¹æ³•æˆªå–éƒ¨åˆ†\n\nconst buf &#x3D; new ArrayBuffer(16); &#x2F;&#x2F; 16å­—èŠ‚\nconst buf1 &#x3D; new ArrayBuffer(16);\nbuf1 &#x3D; buf.slice(4, 10);\n\n\nç±»ä¼¼äº mallocmalloc åˆ†é…å¤±è´¥è¿”å› null ArrayBuffer æŠ›å‡ºé”™è¯¯malloc å¯ä»¥åˆ©ç”¨è™šæ‹Ÿå†…å­˜ ArrayBuffer ä¸è¶…è¿‡ Number.MAX_SAFE_InTEGER(2^52 - 1)malloc ä¸ä¼šè¿›è¡Œåˆå§‹åŒ– ArrayBuffer åˆå§‹åŒ–ä¸º 0malloc è‡ªå·±é‡Šæ”¾å†…å­˜ ArrayBuffer è‡ªåŠ¨é‡Šæ”¾\n\nDataView(æ–‡ä»¶ I/O å’Œç½‘ç»œ I/O )\nå¿…é¡»åœ¨å¯¹å·²æœ‰çš„ ArrayBuffer è¯»å–æˆ–å†™å…¥æ—¶æ‰èƒ½åˆ›å»º DataView å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å¯ä»¥ä½¿ç”¨å…¨éƒ¨æˆ–åˆ† ArrayBufferï¼Œä¸”ç»´æŠ¤ç€å¯¹è¯¥ç¼“å†²å®ä¾‹çš„å¼•ç”¨ï¼Œä»¥åŠè§†å›¾åœ¨ç¼“å†²ä¸­å¼€å§‹çš„ä½ç½®DataView åº”è¯¥ä½¿ç”¨ ElementType æ¥å®ç° JavaScript çš„ Number ç±»å‹åˆ°ç¼“å†²å†…äºŒè¿›åˆ¶æ ¼å¼çš„è½¬æ¢ã€‚DataView ä¸ºä¸Šè¡¨ä¸­çš„æ¯ç§ç±»å‹éƒ½æš´éœ²äº† get å’Œ set æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä½¿ç”¨ byteOffsetï¼ˆå­—èŠ‚åç§»é‡ï¼‰å®šä½è¦è¯»å–æˆ–å†™å…¥å€¼çš„ä½ç½®\n\n&#x2F;&#x2F; é»˜è®¤å…¨éƒ¨ä½¿ç”¨\n&#x2F;&#x2F; å†™å…¥æ“ä½œ\nconst buf &#x3D; new ArrayBuffer(16);\nalert(fullDataView.buffer &#x3D;&#x3D;&#x3D; buf); &#x2F;&#x2F; true\nconst firstHalfDataView &#x3D; new DataView(buf, 0, 8);\nalert(firstHalfDataView.byteOffset); &#x2F;&#x2F; 0\nalert(firstHalfDataView.byteLength); &#x2F;&#x2F; 8\nconst secondHalfDataView &#x3D; new DataView(buf, 8);\nalert(secondHalfDataView.byteOffset); &#x2F;&#x2F; 8\n\n&#x2F;&#x2F; è¯»æ“ä½œ\n\nconst buf &#x3D; new ArrayBuffer(2);\nconst view &#x3D; new DataView(buf);\n&#x2F;&#x2F; è¯´æ˜æ•´ä¸ªç¼“å†²ç¡®å®æ‰€æœ‰äºŒè¿›åˆ¶ä½éƒ½æ˜¯ 0\n&#x2F;&#x2F; æ£€æŸ¥ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå­—ç¬¦\nalert(view.getInt8(0)); &#x2F;&#x2F; 0\nalert(view.getInt8(1)); &#x2F;&#x2F; 0\n&#x2F;&#x2F; æ£€æŸ¥æ•´ä¸ªç¼“å†²\nalert(view.getInt16(0)); &#x2F;&#x2F; 0\n&#x2F;&#x2F; å°†æ•´ä¸ªç¼“å†²éƒ½è®¾ç½®ä¸º 1\n&#x2F;&#x2F; 255 çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 11111111ï¼ˆ2^8 - 1ï¼‰\nview.setUint8(0, 255);\n&#x2F;&#x2F; DataView ä¼šè‡ªåŠ¨å°†æ•°æ®è½¬æ¢ä¸ºç‰¹å®šçš„ ElementType\n&#x2F;&#x2F; 255 çš„åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯ 0xFF\nview.setUint8(1, 0xff);\n&#x2F;&#x2F; ç°åœ¨ï¼Œç¼“å†²é‡Œéƒ½æ˜¯ 1 äº†\n&#x2F;&#x2F; å¦‚æœæŠŠå®ƒå½“æˆäºŒè¡¥æ•°çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œåˆ™åº”è¯¥æ˜¯-1\nalert(view.getInt16(0)); &#x2F;&#x2F; -1\n\nå­—èŠ‚åº\nå¤§ç«¯å¯¹é½æˆ–è€…å°ç«¯å¯¹é½\n\nconst buf &#x3D; new ArrayBuffer(2);\nconst view &#x3D; new DataView(buf);\n&#x2F;&#x2F; å¡«å……ç¼“å†²ï¼Œè®©ç¬¬ä¸€ä½å’Œæœ€åä¸€ä½éƒ½æ˜¯ 1\nview.setUint8(0, 0x80); &#x2F;&#x2F; è®¾ç½®æœ€å·¦è¾¹çš„ä½ç­‰äº 1\nview.setUint8(1, 0x01); &#x2F;&#x2F; è®¾ç½®æœ€å³è¾¹çš„ä½ç­‰äº 1\n\n\næ³¨ï¼šDataView å®Œæˆè¯»ã€å†™æ“ä½œçš„å‰ææ˜¯å¿…é¡»æœ‰å……è¶³çš„ç¼“å†²åŒºï¼Œå¦åˆ™å°±ä¼šæŠ›å‡º RangeErrorï¼š\n\nå®šå‹æ•°ç»„const ints &#x3D; new Int32Array(buf);\n&#x2F;&#x2F; æ–¹æ³•å’Œæ™®é€šæ•°ç»„ç±»ä¼¼\n\nMap &amp;&amp; Object\nå†…å­˜å ç”¨ (ä½†ç»™å®šå›ºå®šå¤§å°çš„å†…å­˜ï¼ŒMap å¤§çº¦å¯ä»¥æ¯” Object å¤šå­˜å‚¨ 50%çš„é”®/å€¼å¯¹)\næ’å…¥æ€§èƒ½\næŸ¥æ‰¾é€Ÿåº¦\nåˆ é™¤æ€§èƒ½ä½¿ç”¨ delete åˆ é™¤ Object å±æ€§çš„æ€§èƒ½ä¸€ç›´ä»¥æ¥é¥±å—è¯Ÿç—…ï¼Œç›®å‰åœ¨å¾ˆå¤šæµè§ˆå™¨ä¸­ä»ç„¶å¦‚æ­¤ã€‚ä¸ºæ­¤ï¼Œå‡ºç°äº†ä¸€äº›ä¼ªåˆ é™¤å¯¹è±¡å±æ€§çš„æ“ä½œï¼ŒåŒ…æ‹¬æŠŠå±æ€§å€¼è®¾ç½®ä¸º undefined æˆ– nullã€‚ä½†å¾ˆå¤šæ—¶å€™ï¼Œè¿™éƒ½æ˜¯ä¸€ç§è®¨åŒçš„æˆ–ä¸é€‚å®œçš„æŠ˜ä¸­ã€‚è€Œå¯¹å¤§å¤šæ•°æµè§ˆå™¨å¼•æ“æ¥è¯´ï¼ŒMap çš„ delete()æ“ä½œéƒ½æ¯”æ’å…¥å’ŒæŸ¥æ‰¾æ›´å¿«ã€‚å¦‚æœä»£ç æ¶‰åŠå¤§é‡åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®åº”è¯¥é€‰æ‹© Map\n\nWeakMap\nWeakMap ä¸­çš„â€œweakâ€ï¼ˆå¼±ï¼‰ï¼Œæè¿°çš„æ˜¯ JavaScript åƒåœ¾å›æ”¶ç¨‹åºå¯¹å¾…â€œå¼±æ˜ å°„â€ä¸­é”®çš„æ–¹å¼ã€‚é”®å¿…é¡»æ˜¯ Object æˆ–è€…æ˜¯ç»§æ‰¿ Object çš„ç±»å‹\n\nå¼±é”®\nWeakMap ä¸­â€œweakâ€è¡¨ç¤ºå¼±æ˜ å°„çš„é”®æ˜¯â€œå¼±å¼±åœ°æ‹¿ç€â€çš„ã€‚æ„æ€å°±æ˜¯ï¼Œè¿™äº›é”®ä¸å±äºæ­£å¼çš„å¼•ç”¨ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¼±æ˜ å°„ä¸­å€¼çš„å¼•ç”¨å¯ä¸æ˜¯â€œå¼±å¼±åœ°æ‹¿ç€â€çš„ã€‚åªè¦é”®å­˜åœ¨ï¼Œé”®/å€¼å¯¹å°±ä¼šå­˜åœ¨äºæ˜ å°„ä¸­ï¼Œå¹¶è¢«å½“ä½œå¯¹å€¼çš„å¼•ç”¨ï¼Œå› æ­¤å°±ä¸ä¼šè¢«å½“ä½œåƒåœ¾å›æ”¶\n\nconst vm &#x3D; new WeakMap();\nvm.set(&#123;&#125;, &#39;val&#39;);\n&#x2F;&#x2F; è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ æ‰§è¡Œå®Œä¹‹åå°±ä¼šè¢«å›æ”¶ å˜æˆäº†ç©ºæ˜ å°„\n\nconst wm &#x3D; new WeakMap();\nconst container &#x3D; &#123;\n  key: &#123;&#125;,\n&#125;;\nwm.set(container.key, &#39;val&#39;);\nfunction removeReference() &#123;\n  container.key &#x3D; null;\n&#125;\n&#x2F;&#x2F; ä¸€å¼€å§‹ä¸ä¼šè¢«å›æ”¶ ä¿æŒç€å¯¹å¤–çš„å¼•ç”¨ æ‰§è¡Œå®ŒremoveReference å°±ä¼šè¢«å›æ”¶æ‰\n\nWeakSet\nå’Œ WeakMap ç±»ä¼¼\n\nå¯è¿­ä»£å¯¹è±¡for ofæ•°ç»„ç»“æ„æ‰©å±•è¿ç®—ç¬¦Array.fromåˆ›å»ºé›†åˆåˆ›å»ºæ˜ å°„Promise.allPromise.receyield *\nå¦‚æœå¯¹è±¡çš„åŸå‹é“¾ä¸Šå®ç°äº†iterableæ¥å£ ä¹Ÿå°±å¯ä»¥è¿­ä»£äº†\nè¿­ä»£å™¨åè®®\nä¸€ç§ä¸€æ¬¡ä½¿ç”¨çš„å¯¹è±¡ ç”¨ next()æ–¹æ³•éå†å¯¹è±¡ è¿”å›ä¸€ä¸ª IteratorResult å¯¹è±¡IterattorResult æœ‰ done value é€šè¿‡åˆ¤æ–­è¿™ä¸ªæ¥åˆ¤æ–­è¿­ä»£ç»“æœè¿­ä»£å™¨ä¸æ˜¯å¿«ç…§ å¦‚æœè¿­ä»£çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å˜åŒ– è¿­ä»£å™¨ä¹Ÿä¼šåæ˜ å˜åŒ–è¿­ä»£å™¨ç»´æŠ¤ä¸€ä¸ªå¼•ç”¨ è¿­ä»£å™¨ä¼šé˜»æ­¢æ¥åƒåœ¾å›æ”¶\n\nè‡ªå®šä¹‰è¿­ä»£å™¨class Counter &#123;\n  constructor(limit) &#123;\n    this.count &#x3D; 1;\n    this.limit &#x3D; limit;\n  &#125;\n\n  [Symbol.iterator]() &#123;\n    return &#123;\n      next() &#123;\n        if (this.count &lt;&#x3D; this.limit) &#123;\n          return &#123; done: false, value: this.count++ &#125;;\n        &#125; else &#123;\n          return &#123; done: true, value: undefined &#125;;\n        &#125;\n      &#125;,\n\n      return() &#123;\n        &#x2F;&#x2F; æå‰é€€å‡º\n        console.log(&#39;exiting early&#39;);\n        return &#123; done: true &#125;;\n      &#125;,\n    &#125;;\n  &#125;\n&#125;\n\nå¦‚æœè¿­ä»£å™¨æ²¡æœ‰å…³é—­ å¯ä»¥ä¿å­˜çŠ¶æ€ ç»§ç»­æ‰§è¡Œ\nlet a &#x3D; [1, 2, 3, 4, 5];\nlet iter &#x3D; a[Symbol.iterator]();\n\nfor (let i of iter) &#123;\n  console.log(i);\n  break;\n&#125;\n\n&#x2F;&#x2F; 1\nfor (let i of iter) &#123;\n  console.log(i);\n&#125;\n&#x2F;&#x2F; 2 3 4 5\n\nç”Ÿæˆå™¨function* gen() &#123;&#125;\n&#x2F;&#x2F; ç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°\n\nfunction* gen() &#123;&#125;\n\nconst g &#x3D; gen();\n\ng.next(); &#x2F;&#x2F; è¿”å›å€¼ç±»ä¼¼äºä¸€ä¸ªè¿­ä»£å™¨\n\ng &#x3D;&#x3D;&#x3D; g[Symbol.iterator]();\n&#x2F;&#x2F;  true\n&#x2F;&#x2F; yeild ä¼šä¿å­˜å½“å‰çš„ä½œç”¨åŸŸ ç„¶åæ‰§è¡Œåˆ«çš„ä»£ç  ç„¶åè¿”å›\n\nfunction* generatorFn() &#123;\n  yield 1;\n  yield 2;\n  yield 3;\n&#125;\n\nfor (let x of generatorFn()) &#123;\n  console.log(x);\n&#125;\n\n&#x2F;&#x2F; 1 2 3\n\nfunction* gen(initial) &#123;\n  &#x2F;&#x2F; console.log(initial);\n  console.log(yield);\n  console.log(yield);\n&#125;\n&#x2F;&#x2F; let g &#x3D; gen(&#39;foo&#39;);\nlet g &#x3D; gen();\ng.next(&#39;bar&#39;);\ng.next(&#39;bar&#39;); &#x2F;&#x2F; bar\ng.next(&#39;bar&#39;); &#x2F;&#x2F; bar\n\nfunction* fn() &#123;\n  return yield &#39;foo&#39;;\n&#125;\n\nlet g &#x3D; fn();\nlet res &#x3D; g.next();\nconsole.log(res);\n\nfunction* gen() &#123;\n  yield* [1, 2, 3];\n&#125;\n\nfunction* gen() &#123;\n  for (const x of [1, 2, 3]) &#123;\n    yield x;\n  &#125;\n&#125;\n\nlet g &#x3D; gen();\n\nfor (let x of gen()) &#123;\n  console.log(x);\n&#125;\n&#x2F;&#x2F; yield ä¼šæŠŠå¯è¿­ä»£å¯¹è±¡åºåˆ—åŒ–ä¸ºä¸€ç³»åˆ—å•ç‹¬äº§ç”Ÿçš„å€¼\n","slug":"JavaScript","date":"2021-04-07T08:34:27.488Z","categories_index":"JavaScript","tags_index":"JavaScript","author_index":"éº¦å½“"},{"id":"d99453202fb96ed4663408801fbf0008","title":"Vuex æºç åˆ†æ","content":"vuex ç®€æ˜“å®ç°\n\nlet Vue;\n\nclass ModuleCollection &#123;\n  constructor(options) &#123;\n    this.register([], options);\n  &#125;\n\n  register(path, rootModule) &#123;\n    let module &#x3D; &#123;\n      _rawModule: rootModule,\n      _children: &#123;&#125;,\n      state: rootModule.state,\n    &#125;;\n\n    if (path.length &#x3D;&#x3D; 0) &#123;\n      this.root &#x3D; module;\n    &#125;\n\n    if(rootModule.modules) &#123;\n      for\n    &#125;\n  &#125;\n&#125;\n\nclass Store &#123;\n  constructor(options &#x3D; &#123;&#125;) &#123;\n    &#x2F;&#x2F; çŠ¶æ€èµ‹å€¼\n    this.s &#x3D; new Vue(&#123;\n      data() &#123;\n        return &#123; state: options.state &#125;;\n      &#125;,\n    &#125;);\n    let getters &#x3D; options.getters;\n\n    this.getters &#x3D; &#123;&#125;;\n\n    Object.keys(getters).forEach((getterName) &#x3D;&gt; &#123;\n      Object.defineProperty(this.getters, getterName, &#123;\n        get: () &#x3D;&gt; &#123;\n          return getters[getterName](this.state);\n        &#125;,\n      &#125;);\n    &#125;);\n\n    let mutations &#x3D; options.mutations;\n    this.mutations &#x3D; &#123;&#125;;\n    &#x2F;&#x2F; å‘å¸ƒè®¢é˜…æ¨¡å¼\n    Object.keys(mutations).forEach((mutation) &#x3D;&gt; &#123;\n      this.mutations[mutation] &#x3D; (payload) &#x3D;&gt; &#123;\n        mutations[mutation](this.state, payload);\n      &#125;;\n    &#125;);\n\n    &#x2F;&#x2F; action\n\n    let actions &#x3D; options.actions;\n    this.action &#x3D; &#123;&#125;;\n    Object.keys(actions).forEach((action) &#x3D;&gt; &#123;\n      this.actions[action] &#x3D; (payload, fn) &#x3D;&gt; &#123;\n        fn(this, payload);\n      &#125;;\n    &#125;);\n\n    this._modules &#x3D; new ModuleCollection(); &#x2F;&#x2F; æ•°æ®æ ¼å¼åŒ–\n  &#125;\n\n  dispatch &#x3D; (actionName, payload) &#x3D;&gt; &#123;\n    this.action[actionName](payload);\n  &#125;;\n  &#x2F;&#x2F;æäº¤æ›´æ”¹\n  commit &#x3D; (mutationName, payload) &#x3D;&gt; &#123;\n    this.mutations[mutationName](payload);\n  &#125;;\n\n  get state() &#123;\n    return this.s.state;\n  &#125;\n&#125;\n\nconst install &#x3D; (_Vue) &#x3D;&gt; &#123;\n  Vue &#x3D; _Vue; &#x2F;&#x2F; vueæ„é€ å‡½æ•°\n\n  Vue.mixin(&#123;\n    beforeCreate() &#123;\n      &#x2F;&#x2F; éœ€è¦æ‹¿åˆ°store ç»™æ¯ä¸ªç»„ä»¶å¢åŠ äº†$storeå±æ€§\n      &#x2F;&#x2F; å¯èƒ½æœ‰å¾ˆå¤šVueå®ä¾‹ æœ‰çš„ä¸éœ€è¦store æ²¡æœ‰æ”¾åœ¨VueåŸå‹ä¸Šé¢\n      if (this.$options &amp;&amp; this.$options.store) &#123;\n        &#x2F;&#x2F; ç»™æ ¹å®ä¾‹å¢åŠ $storeå±æ€§\n        this.$store &#x3D; this.$options.store;\n      &#125; else &#123;\n        &#x2F;&#x2F; å•ç‹¬åˆ›å»ºçš„å®ä¾‹\n        this.store &#x3D; this.$parent &amp;&amp; this.$parent.store;\n      &#125;\n    &#125;,\n  &#125;);\n&#125;;\n\nexport default &#123;\n  &#x2F;&#x2F; é»˜è®¤æ‰§è¡Œ vueæ–¹æ³•\n  install,\n&#125;;\n\n","slug":"vuex","date":"2021-04-06T14:27:28.497Z","categories_index":"vue","tags_index":"vue,vuex","author_index":"éº¦å½“"},{"id":"b491bd34f265533799a79211838a0e41","title":"Vue3 å“åº”å¼åŸç†","content":"ç®€å•çš„å®ç° Vue3 å“åº”å¼åŸç†\n\nlet toProxy &#x3D; new WeakMap(); &#x2F;&#x2F; åŸå¯¹è±¡ï¼šä»£ç†è¿‡å¾—å¯¹è±¡\nlet toRaw &#x3D; new WeakMap(); &#x2F;&#x2F; è¢«ä»£ç†è¿‡å¾—å¯¹è±¡: åŸå¯¹è±¡\nfunction isObject(val) &#123;\n  return typeof val &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; val !&#x3D;&#x3D; null;\n&#125;\n\nfunction reactive(target) &#123;\n  return createReactiveObject(target);\n&#125;\n\nfunction hasOwn(target, key) &#123;\n  return target.hasOwnProperty(key);\n&#125;\n\nlet proxy &#x3D; reactive(&#123; name: &#39;zf&#39; &#125;);\n\nfunction createReactiveObject(target) &#123;\n  if (!isObject(target)) return target;\n\n  &#x2F;&#x2F; å¤„ç†å¤šæ¬¡ä»£ç†çš„æ“ä½œ\n  let proxy &#x3D; toProxy.get(target);\n  if (proxy) return proxy;\n  if (toRaw.has(target)) return target;\n  let baseHandler &#x3D; &#123;\n    get(target, key, receiver) &#123;\n      let res &#x3D; Reflect.get(target, key, receiver);\n      &#x2F;&#x2F; å®ç°å¤šå±‚ä»£ç†\n\n      track(target, key);\n      return isObject(res) ? reactive(res) : res;\n    &#125;,\n    set(target, key, value, receiver) &#123;\n      let hadKey &#x3D; hasOwn(target, key);\n      let oldValue &#x3D; target[key];\n      let res &#x3D; Reflect.set(target, key, value, receiver);\n      if (!hadKey) &#123;\n        &#x2F;&#x2F; å¢åŠ å±æ€§\n        trigger(target, &#39;add&#39;, key);\n      &#125; else if (oldValue !&#x3D;&#x3D; value) &#123;\n        &#x2F;&#x2F; ä¿®æ”¹å±æ€§ å±è”½æ²¡æœ‰æ„ä¹‰çš„æ›´æ–°\n        trigger(target, &#39;set&#39;, key);\n      &#125;\n      return res;\n    &#125;,\n    deleteProperty(target, key) &#123;\n      let res &#x3D; Reflect.defineProperty(target, key);\n      return res;\n    &#125;,\n  &#125;;\n  let proxy &#x3D; new Proxy(target, baseHandler);\n  toProxy.set(target, proxy);\n  toRaw.set(proxy, target);\n  return proxy;\n&#125;\n\n&#x2F;&#x2F; ä¾èµ–æ”¶é›† å‘å¸ƒè®¢é˜…\n\nlet activeEffectStacks &#x3D; [];\nlet targetsMap &#x3D; new WeakMap();\nfunction track(target, key) &#123;\n  let effect &#x3D; activeEffectStacks[activeEffectStacks.length - 1];\n  if (effect) &#123;\n    let depMap &#x3D; targetsMap.get(target);\n    if (!depMap) &#123;\n      targetsMap.set(target, (depMap &#x3D; new Map()));\n    &#125;\n    let deps &#x3D; depMap.get(key);\n    if (!deps) &#123;\n      depMap, set(key, (deps &#x3D; new Set()));\n    &#125;\n\n    if (!deps.has(effect)) &#123;\n      deps.add(effect);\n    &#125;\n  &#125;\n&#125;\n\nfunction trigger(target, type, key) &#123;\n  let depsMap &#x3D; targetsMap.get(target);\n  if (depsMap) &#123;\n    let deps &#x3D; depsMap.get(key);\n    if (deps) &#123;\n      deps.forEach((effect) &#x3D;&gt; &#123;\n        effect();\n      &#125;);\n    &#125;\n  &#125;\n&#125;\n\nfunction effect(fn) &#123;\n  &#x2F;&#x2F; fnæ˜¯å“åº”çš„\n  let effect &#x3D; createReactiveEffect(fn);\n  effect();\n&#125;\n\nfunction createReactiveEffect(fn) &#123;\n  let effect &#x3D; function () &#123;\n    return run(effect, fn);\n  &#125;;\n  return effect;\n&#125;\n\nfunction run(effect, fn) &#123;\n  try &#123;\n    activeEffectStacks.push(effect);\n    fn();\n  &#125; finally &#123;\n    activeEffectStacks.pop();\n  &#125;\n&#125;\n","slug":"vue3-reactive","date":"2021-04-06T14:27:28.471Z","categories_index":"vue","tags_index":"vue3","author_index":"éº¦å½“"},{"id":"c6b8115d77691cd594407092998f8ad6","title":"React Hooks ç®€å•ç”¨æ³•","content":"Encapsulating data request with hook\n\nimport React, &#123; Fragment, useState, useEffect &#125; from &#39;react&#39;;\nimport axios from &#39;axios&#39;;\n\nfunction App() &#123;\n  const [data, setData] &#x3D; useState(&#123; hits: [] &#125;);\n  const [query, setQuery] &#x3D; useState(&#39;redux&#39;);\n  const [url, setUrl] &#x3D; useState(\n    &#39;https:&#x2F;&#x2F;hn.algolia.com&#x2F;api&#x2F;v1&#x2F;search?query&#x3D;redux&#39;\n  );\n  const [isLoading, setIsLoading] &#x3D; useState(false);\n  const [isError, setIsError] &#x3D; useState(false);\n\n  useEffect(() &#x3D;&gt; &#123;\n    const fetchData &#x3D; async () &#x3D;&gt; &#123;\n      setIsError(false);\n      setIsLoading(true);\n\n      try &#123;\n        const result &#x3D; await axios(url);\n\n        setData(result.data);\n      &#125; catch (error) &#123;\n        setIsError(true);\n      &#125;\n\n      setIsLoading(false);\n    &#125;;\n\n    fetchData();\n  &#125;, [url]);\n  return (\n    &lt;Fragment&gt;\n      &lt;input\n        type&#x3D;&#39;text&#39;\n        value&#x3D;&#123;query&#125;\n        onChange&#x3D;&#123;(event) &#x3D;&gt; setQuery(event.target.value)&#125;\n      &#x2F;&gt;\n      &lt;button\n        type&#x3D;&#39;button&#39;\n        onClick&#x3D;&#123;() &#x3D;&gt;\n          setUrl(&#96;http:&#x2F;&#x2F;hn.algolia.com&#x2F;api&#x2F;v1&#x2F;search?query&#x3D;$&#123;query&#125;&#96;)\n        &#125;\n      &gt;\n        Search\n      &lt;&#x2F;button&gt;\n\n      &#123;isError &amp;&amp; &lt;div&gt;Something went wrong ...&lt;&#x2F;div&gt;&#125;\n\n      &#123;isLoading ? (\n        &lt;div&gt;Loading ...&lt;&#x2F;div&gt;\n      ) : (\n        &lt;ul&gt;\n          &#123;data.hits.map((item) &#x3D;&gt; (\n            &lt;li key&#x3D;&#123;item.objectID&#125;&gt;\n              &lt;a href&#x3D;&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;&#x2F;a&gt;\n            &lt;&#x2F;li&gt;\n          ))&#125;\n        &lt;&#x2F;ul&gt;\n      )&#125;\n    &lt;&#x2F;Fragment&gt;\n  );\n&#125;\nexport default App;\n\nCustom hookimport React, &#123; Fragment, useState, useEffect &#125; from &#39;react&#39;;\nimport axios from &#39;axios&#39;;\n\nconst useDataApi &#x3D; (initialUrl, initialData) &#x3D;&gt; &#123;\n  const [data, setData] &#x3D; useState(initialData);\n  const [url, setUrl] &#x3D; useState(initialUrl);\n  const [isLoading, setIsLoading] &#x3D; useState(false);\n  const [isError, setIsError] &#x3D; useState(false);\n\n  useEffect(() &#x3D;&gt; &#123;\n    const fetchData &#x3D; async () &#x3D;&gt; &#123;\n      setIsError(false);\n      setIsLoading(true);\n\n      try &#123;\n        const result &#x3D; await axios(url);\n\n        setData(result.data);\n      &#125; catch (error) &#123;\n        setIsError(true);\n      &#125;\n\n      setIsLoading(false);\n    &#125;;\n\n    fetchData();\n  &#125;, [url]);\n\n  return [&#123; data, isLoading, isError &#125;, setUrl];\n&#125;;\n\nfunction App() &#123;\n  const [query, setQuery] &#x3D; useState(&#39;redux&#39;);\n  const [&#123; data, isLoading, isError &#125;, doFetch] &#x3D; useDataApi(\n    &#39;https:&#x2F;&#x2F;hn.algolia.com&#x2F;api&#x2F;v1&#x2F;search?query&#x3D;redux&#39;,\n    &#123;\n      hits: [],\n    &#125;\n  );\n\n  return (\n    &lt;Fragment&gt;\n      &lt;form\n        onSubmit&#x3D;&#123;(event) &#x3D;&gt; &#123;\n          doFetch(&#96;http:&#x2F;&#x2F;hn.algolia.com&#x2F;api&#x2F;v1&#x2F;search?query&#x3D;$&#123;query&#125;&#96;);\n\n          event.preventDefault();\n        &#125;&#125;\n      &gt;\n        &lt;input\n          type&#x3D;&#39;text&#39;\n          value&#x3D;&#123;query&#125;\n          onChange&#x3D;&#123;(event) &#x3D;&gt; setQuery(event.target.value)&#125;\n        &#x2F;&gt;\n        &lt;button type&#x3D;&#39;submit&#39;&gt;Search&lt;&#x2F;button&gt;\n      &lt;&#x2F;form&gt;\n\n      &#123;isError &amp;&amp; &lt;div&gt;Something went wrong ...&lt;&#x2F;div&gt;&#125;\n\n      &#123;isLoading ? (\n        &lt;div&gt;Loading ...&lt;&#x2F;div&gt;\n      ) : (\n        &lt;ul&gt;\n          &#123;data.hits.map((item) &#x3D;&gt; (\n            &lt;li key&#x3D;&#123;item.objectID&#125;&gt;\n              &lt;a href&#x3D;&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;&#x2F;a&gt;\n            &lt;&#x2F;li&gt;\n          ))&#125;\n        &lt;&#x2F;ul&gt;\n      )&#125;\n    &lt;&#x2F;Fragment&gt;\n  );\n&#125;\n\nexport default App;\n\nuseToggleimport &#123; useCallback, useState &#125; from &#39;react&#39;;\nfunction App() &#123;\n  const [isTextChanged, setIsTextChanged] &#x3D; useToggle();\n  return (\n    &lt;button onClick&#x3D;&#123;setIsTextChanged&#125;&gt;\n      &#123;isTextChanged ? &#39;Toggled&#39; : &#39;Click to Toggle&#39;&#125;\n    &lt;&#x2F;button&gt;\n  );\n&#125;\nconst useToggle &#x3D; (initialState: boolean &#x3D; false): [boolean, any] &#x3D;&gt; &#123;\n  const [state, setState] &#x3D; useState &lt; boolean &gt; initialState;\n  const toggle &#x3D; useCallback((): void &#x3D;&gt; setState((state) &#x3D;&gt; !state), []);\n  return [state, toggle];\n&#125;;\n","slug":"useFetchData","date":"2021-04-06T14:27:28.438Z","categories_index":"React","tags_index":"React","author_index":"éº¦å½“"},{"id":"ba2efac7316616866db1719079267951","title":"Symbol åŸºç¡€å­¦ä¹ ","content":"Symbol å†…ç½®ç¬¦å·\nECMAScript 6 ä¹Ÿå¼•å…¥äº†ä¸€æ‰¹å¸¸ç”¨å†…ç½®ç¬¦å·ï¼ˆwell-known symbolï¼‰ï¼Œç”¨äºæš´éœ²è¯­è¨€å†…éƒ¨è¡Œä¸ºï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥è®¿é—®ã€é‡å†™æˆ–æ¨¡æ‹Ÿè¿™äº›è¡Œä¸ºã€‚è¿™äº›å†…ç½®ç¬¦å·éƒ½ä»¥ Symbol å·¥å‚å‡½æ•°å­—ç¬¦ä¸²å±æ€§çš„å½¢å¼å­˜åœ¨ã€‚è¿™äº›å†…ç½®ç¬¦å·æœ€é‡è¦çš„ç”¨é€”ä¹‹ä¸€æ˜¯é‡æ–°å®šä¹‰å®ƒä»¬ï¼Œä»è€Œæ”¹å˜åŸç”Ÿç»“æ„çš„è¡Œä¸ºã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“ for-of å¾ªç¯ä¼šåœ¨ç›¸å…³å¯¹è±¡ä¸Šä½¿ç”¨ Symbol.iterator å±æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸Šé‡æ–°å®šä¹‰ Symbol.iterator çš„å€¼ï¼Œæ¥æ”¹å˜ for-of åœ¨è¿­ä»£è¯¥å¯¹è±¡æ—¶çš„è¡Œä¸ºã€‚è¿™äº›å†…ç½®ç¬¦å·ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œå®ƒä»¬å°±æ˜¯å…¨å±€å‡½æ•° Symbol çš„æ™®é€šå­—ç¬¦ä¸²å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªç¬¦å·çš„å®ä¾‹ã€‚æ‰€æœ‰å†…ç½®ç¬¦å·å±æ€§éƒ½æ˜¯ä¸å¯å†™ã€ä¸å¯æšä¸¾ã€ä¸å¯é…ç½®çš„ã€‚\n\n\n\nSymbol.asyncIterator\n&#x2F;&#x2F; for-await-of å®ç°è°ƒç”¨\nclass Emitter &#123;\n  constructor(max) &#123;\n    this.max &#x3D; max;\n    this.asyncIdx &#x3D; 0;\n  &#125;\n  async *[Symbol.asyncIterator]() &#123;\n    while (this.asyncIdx &lt; this.max) &#123;\n      yield new Promise((resolve) &#x3D;&gt; resolve(this.asyncIdx++));\n    &#125;\n  &#125;\n&#125;\nasync function asyncCount() &#123;\n  let emitter &#x3D; new Emitter(5);\n  for await (const x of emitter) &#123;\n    console.log(x);\n  &#125;\n&#125;\nasyncCount();\n&#x2F;&#x2F; 0 1 2 3 4\n\nSymbol.hasInstance\n&#x2F;&#x2F; instanceof è°ƒç”¨\n\nSymbol.isConcatSpreadable\n&#x2F;&#x2F; ä½¿ç”¨concatçš„æ—¶å€™ä¼šä¸ä¼šè¢«æ‰“å¹³\nlet initial &#x3D; [&#39;foo&#39;];\nlet arrayLikeObject &#x3D; &#123; length: 1, 0: &#39;baz&#39; &#125;;\nconsole.log(arrayLikeObject[Symbol.isConcatSpreadable]); &#x2F;&#x2F; undefined\nconsole.log(initial.concat(arrayLikeObject)); &#x2F;&#x2F; [&#39;foo&#39;, &#123;...&#125;]\narrayLikeObject[Symbol.isConcatSpreadable] &#x3D; true;\nconsole.log(initial.concat(arrayLikeObject)); &#x2F;&#x2F; [&#39;foo&#39;, &#39;baz&#39;]\n&#x2F;*\n  [ &#39;foo&#39;, &#123; &#39;0&#39;: &#39;baz&#39;, length: 1 &#125; ]\n  [ &#39;foo&#39;, &#39;baz&#39; ]\n*&#x2F;\n\nSymbol.iterator\nclass Emitter &#123;\n  constructor(max) &#123;\n    this.max &#x3D; max;\n    this.idx &#x3D; 0;\n  &#125;\n  *[Symbol.iterator]() &#123;\n    while (this.idx &lt; this.max) &#123;\n      yield this.idx++;\n    &#125;\n  &#125;\n&#125;\nfunction count() &#123;\n  let emitter &#x3D; new Emitter(5);\n  for (const x of emitter) &#123;\n    console.log(x);\n  &#125;\n&#125;\ncount();\n\nSymbol.match\n&#x2F;&#x2F; String.prototype.match() è°ƒç”¨\n\nSymbol.replaceSymbol.searchSymbol.split\nSymbol.toPrimitiveSymbol.toStringTag\n","slug":"symbol","date":"2021-04-06T14:27:28.412Z","categories_index":"JavaScript","tags_index":"JavaScript","author_index":"éº¦å½“"},{"id":"f45f275952c50e73ccfd35d25a4b9c92","title":"redux && redux-middleware","content":"redux\n\nimport &#123; createStore &#125; from &#39;redux&#39;;\nlet INC &#x3D; Symbol.for(&#39;INC&#39;);\nlet DEC &#x3D; Symbol.for(&#39;DEC&#39;);\nlet initialState &#x3D; 0;\nfunction reducer(state &#x3D; initialState, action) &#123;\n  switch (action.type) &#123;\n    case INC:\n      return state + 1;\n    case DEC:\n      return state - 1;\n    default:\n      return state;\n  &#125;\n&#125;\n\n&#x2F;**\n * redux actionæœ‰è¦æ±‚ æœ‰ä¸ªä¸æ˜¯undefinedçš„typeç±»å‹\n *&#x2F;\nlet store &#x3D; createStore(reducer);\n\nlet state &#x3D; store.getState();\nlet countValue &#x3D; document.getElementById(&#39;counter-value&#39;);\nlet inc &#x3D; document.getElementById(&#39;inc-btn&#39;);\nlet dec &#x3D; document.getElementById(&#39;dec-btn&#39;);\nconsole.log(state);\n\nfunction render() &#123;\n  countValue.innerHTML &#x3D; store.getState();\n&#125;\n\nrender();\n\nstore.subscribe(render);\n\ninc.addEventListener(&#39;click&#39;, function () &#123;\n  store.dispatch(&#123; type: INC &#125;);\n&#125;);\n\ndec.addEventListener(&#39;click&#39;, function () &#123;\n  store.dispatch(&#123; type: DEC &#125;);\n&#125;);\n\ncreate-store.js(ç‰ˆæœ¬ä¸€)import isPlainObject from &#39;.&#x2F;utils&#x2F;isPlainObject&#39;;\nimport ActionTypes from &#39;.&#x2F;utils&#x2F;actionType&#39;;\nexport default function createStore(reducer, preloadedState) &#123;\n  if (typeof reducer !&#x3D;&#x3D; &#39;function&#39;) &#123;\n    throw new Error(&#39;reducer must be a function&#39;);\n  &#125;\n\n  &#x2F;*******************************&#x2F;\n  &#x2F;** initiallize the base property  *&#x2F;\n  let currentState &#x3D; preloadedState;\n  let currentReducer &#x3D; reducer;\n  let currentListeners &#x3D; [];\n  &#x2F;*******************************&#x2F;\n\n  function getState() &#123;\n    return currentState;\n  &#125;\n\n  function dispatch(action) &#123;\n    if (!isPlainObject(action)) &#123;\n      throw new Error(&#39;action must be a plainObject&#39;);\n    &#125;\n    if (typeof action.type &#x3D;&#x3D;&#x3D; &#39;undefined&#39;) &#123;\n      throw new Error(&#39;action need a type property&#39;);\n    &#125;\n    currentState &#x3D; currentReducer(currentState, action);\n    for (let i &#x3D; 0; i &lt; currentListeners.length; i++) &#123;\n      let listener &#x3D; currentListeners[i];\n      listener();\n    &#125;\n    return action;\n  &#125;\n\n  dispatch(&#123; type: ActionTypes.INIT &#125;);\n  function subScribe(listener) &#123;\n    currentListeners.push(listener);\n    return function unsubScribe() &#123;\n      const index &#x3D; currentListeners.indexOf(listener);\n      currentListeners.splice(index, 1);\n    &#125;;\n  &#125;\n\n  return &#123;\n    getState,\n    subScribe,\n    dispatch,\n  &#125;;\n&#125;\n\nbindActionCreatorfunction bindActionCreator(actionCreator, dispatch) &#123;\n  return function () &#123;\n    return dispatch(actionCreator.apply(this, arguments));\n  &#125;;\n&#125;\n\nfunction bindActionCreators(actionCreators, dispatch) &#123;\n  if (typeof actionCreators &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;\n    return bindActionCreator(actionCreators, dispatch);\n  &#125;\n  const boundActionCreators &#x3D; &#123;&#125;;\n  for (const key in actionCreators) &#123;\n    boundActionCreators[key] &#x3D; bindActionCreator(actionCreators[key], dispatch);\n  &#125;\n  return boundActionCreators;\n&#125;\n\nexport default bindActionCreators;\n\ncombineReducerexport default function combineReducer(reducers) &#123;\n  const reducerkeys &#x3D; Object.keys(reducers);\n\n  return function (state &#x3D; &#123;&#125;, action) &#123;\n    let nextState &#x3D; &#123;&#125;;\n    for (let i &#x3D; 0; i &lt; reducerkeys.length; i++) &#123;\n      const key &#x3D; reducerkeys[i];\n      const reducer &#x3D; reducers[key];\n      const previousStateForKey &#x3D; state[key];\n      const nextStateForkey &#x3D; reducer(previousStateForKey, action);\n      nextState[key] &#x3D; nextStateForkey;\n    &#125;\n\n    return nextState;\n  &#125;;\n&#125;\n\nutilexport default function isPlainObject(obj) &#123;\n  if (typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\n    return false;\n  &#125;\n\n  let proto &#x3D; obj;\n  while (Object.getPrototypeOf(proto)) &#123;\n    proto &#x3D; Object.getPrototypeOf(proto);\n  &#125;\n\n  return Object.getPrototypeOf(obj) &#x3D;&#x3D;&#x3D; proto;\n&#125;\n\napplyMiddleWarefunction applyMiddleWare(...middlewares) &#123;\n  return function (createStore) &#123;\n    return function (reducer) &#123;\n      let store &#x3D; createStore();\n      let dispath &#x3D; () &#x3D;&gt; &#123;\n        throw new Error();\n      &#125;;\n      let middlewareAPI &#x3D; &#123;\n        getStore: store.getState,\n        dispatch: (...args) &#x3D;&gt; dispath(...args),\n      &#125;;\n      &#x2F;&#x2F; middleware &#x3D; middleware(store);\n      &#x2F;&#x2F; dispath &#x3D; middleware(store.dispatch);\n\n      const chain &#x3D; middlewares.map((middleware) &#x3D;&gt; middleware(middlewareAPI));\n      dispath &#x3D; componse(...chain)(store.dispatch)\n      return &#123;\n        ...store,\n        dispath,\n      &#125;;\n    &#125;;\n  &#125;;\n&#125;\n\ncomposefunction compose(...funcs) &#123;\n  if (funcs.length &#x3D;&#x3D;&#x3D; 0) &#123;\n    return (args) &#x3D;&gt; args;\n  &#125;\n  if (funcs.length &#x3D;&#x3D;&#x3D; 1) &#123;\n    return funcs[0];\n  &#125;\n\n  return funcs.reduce((a, b) &#x3D;&gt; (...args) &#x3D;&gt; a(b(...args)));\n&#125;\n\nexport default compose;\n\nreact-reudxindex.jsimport Provider from &#39;.&#x2F;Provider&#39;;\nimport connect from &#39;.&#x2F;connect&#39;;\n\nexport &#123; Provider, connect &#125;;\n\nProvider.jsimport React, &#123; Component &#125; from &#39;react&#39;;\nimport ReduxContext from &#39;.&#x2F;context&#39;;\n\nclass Provider extends Component &#123;\n  render() &#123;\n    return (\n      &lt;ReduxContext.Provider value&#x3D;&#123;this.props.store&#125;&gt;\n        &#123;this.props.children&#125;\n      &lt;&#x2F;ReduxContext.Provider&gt;\n    );\n  &#125;\n&#125;\n\nexport default Provider;\n\nconnect.jsimport React from &#39;react&#39;;\nimport ReduxContext from &#39;.&#x2F;context&#39;;\nimport bindActionCreator from &#39;..&#x2F;redux&#x2F;bindActionCreator&#39;;\nexport default function connect(mapStateToProps, mapDispatchToProps) &#123;\n  return function (WrappedComponent) &#123;\n    return class extends React.Component &#123;\n      static contextType &#x3D; ReduxContext;\n      constructor(props, context) &#123;\n        super(props);\n        &#x2F;** context &#x3D; &#123;store: this.props.store&#125; *&#x2F;\n        this.state &#x3D; mapDispatchToProps(context.store.getState());\n      &#125;\n      componentDidCatch() &#123;\n        this.unsubscribe &#x3D; this.context.store.subscribe(() &#x3D;&gt; &#123;\n          this.setState(mapStateToProps(this.context.store.getState()));\n        &#125;);\n      &#125;\n      componentWillUnmount() &#123;\n        this.unsubscribe();\n      &#125;\n      render() &#123;\n        let action &#x3D; bindActionCreator(\n          mapDispatchToProps,\n          this.context.store.dispatch\n        );\n        return &lt;WrappedComponent &#123;...this.state&#125; &#123;...action&#125; &#x2F;&gt;;\n      &#125;\n    &#125;;\n  &#125;;\n&#125;\n\ncontext.jsimport React from &#39;react&#39;;\n\nconst ReduxContext &#x3D; React.createContext(null);\nexport default ReduxContext;\n\nredux-promisefunction isPromise(obj) &#123;\n  return (\n    !!obj &amp;&amp;\n    (typeof obj &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof obj &#x3D;&#x3D;&#x3D; &#39;function&#39;) &amp;&amp;\n    typeof obj.then &#x3D;&#x3D;&#x3D; &#39;function&#39;\n  );\n&#125;\nexport default function (&#123; dispatch, getState &#125;) &#123;\n  return (next) &#x3D;&gt; (action) &#x3D;&gt; &#123;\n    return isPromise(action.payload)\n      ? action.payload.then((result) &#x3D;&gt; &#123;\n          dispatch(&#123; ...action, payload: result &#125;);\n        &#125;)\n      : next(action);\n  &#125;;\n&#125;\n\nreudx-thunkfunction createThunkMiddleware() &#123;\n  return (&#123; dispatch, getState &#125; &#x2F;** middlewareAPI *&#x2F;) &#x3D;&gt; (next) &#x3D;&gt; (\n    action\n  ) &#x3D;&gt; &#123;\n    if (typeof action &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;\n      return action(dispatch, getState);\n    &#125;\n    return next(action);\n  &#125;;\n&#125;\n\n","slug":"redux && redux-middleware","date":"2021-04-06T14:27:28.404Z","categories_index":"React","tags_index":"React,redux,redux-middleware","author_index":"éº¦å½“"},{"id":"89dff2a6379feafc73b36875ccf71035","title":"react-setState","content":"react-state æµç¨‹\n\nindex.js&#x2F;** äº‹åŠ¡ ç”¨wrapperåŒ…è£…èµ·æ¥ *&#x2F;\nclass Transaction &#123;\n  constructor(wrappers) &#123;\n    this.wrappers &#x3D; wrappers;\n  &#125;\n  &#x2F;** AOP ç¼–ç¨‹æ¦‚å¿µ  *&#x2F;\n  perform(anyMethod) &#123;\n    this.wrappers.forEach((wrapper) &#x3D;&gt; wrapper.initialize());\n    anyMethod();\n    this.wrappers.forEach((wrapper) &#x3D;&gt; wrapper.close());\n  &#125;\n&#125;\nlet batchingStrategy &#x3D; &#123;\n  isBatchingStrates: false &#x2F;** æ ‡è®°æ˜¯å¦æ˜¯æ‰¹é‡æ›´æ–°æ¨¡å¼ *&#x2F;,\n  dirtyComponent: [] &#x2F;** è„ç»„ä»¶ ç»„ä»¶çš„çŠ¶æ€å’ŒUIä¸åŒ¹é…  *&#x2F;,\n  batchedUpdates() &#123;\n    &#x2F;** æ‰§è¡Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œ *&#x2F;\n    this.dirtyComponent.forEach((component) &#x3D;&gt; component.updateComonent());\n  &#125;,\n&#125;;\nclass Updater &#123;\n  constructor(component) &#123;\n    this.component &#x3D; component;\n    this.pendingState &#x3D; [];\n  &#125;\n  addState(partcialState) &#123;\n    this.pendingState.push(partcialState);\n    &#x2F;** åˆ¤æ–­æ˜¯ä¸æ˜¯æ‰¹é‡æ›´æ–°æ¨¡å¼ å¦‚æœæ˜¯æ‰¹é‡æ›´æ–° å°†ç»„ä»¶æ”¾åˆ°è„ç»„ä»¶é‡Œ åšåˆ°å¼‚æ­¥æ›´æ–° *&#x2F;\n    batchingStrategy.isBatchingStrates\n      ? batchingStrategy.dirtyComponent.push(this.component)\n      : this.component.updateComonent();\n  &#125;\n&#125;\nclass Component &#123;\n  constructor(props) &#123;\n    this.props &#x3D; props;\n    this.$updater &#x3D; new Updater(this);\n  &#125;\n  createDOMFromDOMString(domString) &#123;\n    let div &#x3D; document.createElement(&#39;div&#39;);\n    div.innerHTML &#x3D; domString;\n    return div.children[0];\n  &#125;\n  setState(partcialState) &#123;\n    this.$updater.addState(partcialState);\n  &#125;\n\n  &#x2F;** ç»„ä»¶çš„æ›´æ–°æ–¹æ³• åˆå¹¶æ‰€æœ‰çš„çŠ¶æ€ ç„¶åè¿›è¡Œç»Ÿä¸€çš„é¡µé¢å…ƒç´ UIçš„æ›¿æ¢ *&#x2F;\n  updateComonent() &#123;\n    this.$updater.pendingState.forEach((partcialState) &#x3D;&gt;\n      Object.assign(this.setState, partcialState)\n    );\n    this.$updater.pendingState.length &#x3D; 0; &#x2F;** æ¸…ç©ºé˜Ÿåˆ— *&#x2F;\n    let oldElemet &#x3D; this.domElement;\n    let newElement &#x3D; this.renderElement();\n    oldElemet.parentElement.replaceChild(newElement, oldElemet);\n  &#125;\n\n  &#x2F;** åˆ›å»ºé¡µé¢å…ƒç´  *&#x2F;\n  renderElement() &#123;\n    let htmlString &#x3D; this.render();\n    this.domElement &#x3D; this.createDOMFromDOMString(htmlString);\n    this.domElement.component &#x3D; this;\n    return this.domElement;\n  &#125;\n\n  &#x2F;** ç»„ä»¶çš„æŒ‚è½½æ–¹æ³•  *&#x2F;\n  mount(container) &#123;\n    container.appendChild(this.renderElement());\n  &#125;\n&#125;\n\nlet transaction &#x3D; new Transaction([\n  &#123;\n    initialize() &#123;\n      &#x2F;** äº‹ä»¶å¼€å¯çš„æ—¶å€™è¿›å…¥æ‰¹é‡æ›´æ–°æ¨¡å¼  *&#x2F;\n      batchingStrategy.isBatchingStrates &#x3D; true;\n    &#125;,\n    close() &#123;\n      &#x2F;** äº‹ä»¶ç»“æŸçš„æ—¶å€™å…³é—­æ‰¹é‡æ›´æ–°æ¨¡å¼  *&#x2F;\n      batchingStrategy.isBatchingStrates &#x3D; false;\n      &#x2F;** è„ç»„ä»¶è¿›è¡ŒçŠ¶æ€çš„æ›´æ–° *&#x2F;\n      batchingStrategy.batchedUpdates();\n    &#125;,\n  &#125;,\n]);\n\n&#x2F;** ç»Ÿä¸€çš„äº‹ä»¶å¤„ç† æŒ‚è½½åˆ°å…¨å±€  *&#x2F;\nwindow.trigger &#x3D; function (event, mothodName) &#123;\n  &#x2F;** æ‹¿åˆ°ç»„ä»¶çš„å®ä¾‹(äº‹ä»¶å§”æ‰˜) æ‰§è¡Œç»‘å®šçš„æ–¹æ³• *&#x2F;\n  let component &#x3D; event.target.component;\n  &#x2F;** wrapperåŒ…è£…èµ·æ¥ å¤„ç†ä¸€äº›ç›¸å…³çš„äº‹ä»¶ *&#x2F;\n  transaction.perform(component[mothodName].bind(component));\n&#125;;\n\n&#x2F;** å­ç»„ä»¶ *&#x2F;\nclass Counter extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; number: 0 &#125;;\n  &#125;\n  add() &#123;\n    this.setState(&#123; number: this.state.number + 1 &#125;);\n  &#125;\n\n  render() &#123;\n    return &#96;&lt;button onclick&#x3D;&quot;trigger(event, &#39;add&#39;)&quot;&gt;$&#123;this.state.number&#125;&lt;&#x2F;button&gt;&#96;;\n  &#125;\n&#125;\n\nindex.html&lt;!DOCTYPE html&gt;\n&lt;html lang&#x3D;&quot;en&quot;&gt;\n  &lt;head&gt;\n    &lt;meta charset&#x3D;&quot;UTF-8&quot; &#x2F;&gt;\n    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot; &#x2F;&gt;\n    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;\n    &lt;title&gt;Document&lt;&#x2F;title&gt;\n  &lt;&#x2F;head&gt;\n  &lt;body&gt;\n    &lt;div id&#x3D;&quot;count-app&quot;&gt;&lt;&#x2F;div&gt;\n  &lt;&#x2F;body&gt;\n  &lt;script src&#x3D;&quot;.&#x2F;index.js&quot;&gt;&lt;&#x2F;script&gt;\n  &lt;script&gt;\n    let countApp &#x3D; document.getElementById(&#39;count-app&#39;);\n    let res &#x3D; new Counter().render();\n    res.mount(countApp);\n  &lt;&#x2F;script&gt;\n&lt;&#x2F;html&gt;\n","slug":"react-setState","date":"2021-04-06T14:27:28.394Z","categories_index":"React","tags_index":"React","author_index":"éº¦å½“"},{"id":"50552075ed1d1cbaae410e21993db179","title":"react-router-dom","content":"BrowserRouter\n\nimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\n\nlet pushState &#x3D; window.history.pushState;\n\nclass HashRouter extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;\n      location: &#123; pathname: window.location.pathname, state: null &#125;,\n    &#125;;\n  &#125;\n  componentDidMount() &#123;\n    window.history.pushState &#x3D; (state, title, url) &#x3D;&gt; &#123;\n      pushState.call(window.history, state, title, url);\n      window.onpushstate.call(this, state, url);\n    &#125;;\n    window.onpopstate &#x3D; (event) &#x3D;&gt; &#123;\n      this.setState(&#123;\n        location: &#123;\n          ...this.state.location,\n          pathname: window.location.pathname,\n          state: event.state,\n        &#125;,\n      &#125;);\n    &#125;;\n    window.onpushstate &#x3D; (state, pathname) &#x3D;&gt; &#123;\n      this.setState(&#123;\n        location: &#123;\n          ...this.state.location,\n          pathname: pathname,\n          state: state,\n        &#125;,\n      &#125;);\n    &#125;;\n  &#125;\n  render() &#123;\n    let that &#x3D; this;\n    let value &#x3D; &#123;\n      location: that.state.location,\n      history: &#123;\n        push(to) &#123;\n          &#x2F;** é˜»æ­¢è·³è½¬ *&#x2F;\n          if (that.block) &#123;\n            let confirm &#x3D; window.confirm(\n              that.block(typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39; ? to : &#123; pathname: to &#125;)\n            );\n            if (!confirm) return;\n          &#125;\n          if (typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39;) &#123;\n            let &#123; pathname, state &#125; &#x3D; to;\n            window.history.pushState(state, &#39;&#39;, pathname);\n          &#125; else &#123;\n            window.history.pushState(null, &#39;&#39;, to);\n          &#125;\n        &#125;,\n        block(message) &#123;\n          that.block &#x3D; message;\n        &#125;,\n      &#125;,\n    &#125;;\n    return (\n      &lt;Context.Provider value&#x3D;&#123;value&#125;&gt;&#123;this.props.children&#125;&lt;&#x2F;Context.Provider&gt;\n    );\n  &#125;\n&#125;\n\nexport default HashRouter;\n\ncontext&#x2F;** æš´éœ²å‡ºæ•´ä¸ªåº“çš„contextä¸Šä¸‹æ–‡  *&#x2F;\nimport React from &#39;react&#39;;\n\nconst Context &#x3D; React.createContext();\n\nexport default Context;\n\nHashRouterimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\nclass HashRouter extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;\n      location: &#123; pathname: window.location.hash.slice(1), state: null &#125;,\n    &#125;;\n    this.locationState &#x3D; null;\n  &#125;\n  componentDidMount() &#123;\n    window.location.hash &#x3D; window.location.hash || &#39;&#x2F;&#39;;\n    window.addEventListener(&#39;hashchange&#39;, () &#x3D;&gt; &#123;\n      this.setState(&#123;\n        location: &#123;\n          ...this.state.location,\n          pathname: window.location.hash.slice(1),\n          state: this.locationState,\n        &#125;,\n      &#125;);\n    &#125;);\n  &#125;\n  render() &#123;\n    let that &#x3D; this;\n    let value &#x3D; &#123;\n      location: that.state.location,\n      history: &#123;\n        push(to) &#123;\n          &#x2F;** é˜»æ­¢è·³è½¬ *&#x2F;\n          if (that.block) &#123;\n            let confirm &#x3D; window.confirm(\n              that.block(typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39; ? to : &#123; pathname: to &#125;)\n            );\n            if (!confirm) return;\n          &#125;\n          if (typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39;) &#123;\n            let &#123; pathname, state &#125; &#x3D; to;\n            that.locationState &#x3D; state;\n            window.location.hash &#x3D; pathname;\n          &#125; else &#123;\n            that.locationState &#x3D; null;\n            window.location.hash &#x3D; to;\n          &#125;\n        &#125;,\n        block(message) &#123;\n          that.block &#x3D; message;\n        &#125;,\n      &#125;,\n    &#125;;\n    return (\n      &lt;Context.Provider value&#x3D;&#123;value&#125;&gt;&#123;this.props.children&#125;&lt;&#x2F;Context.Provider&gt;\n    );\n  &#125;\n&#125;\n\nexport default HashRouter;\n\nLinkimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\nclass Link extends Component &#123;\n  static contextType &#x3D; Context;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;&#125;;\n  &#125;\n  render() &#123;\n    &#x2F;** æ³¨æ„åˆå¹¶ä¸Šéƒ¨ä¼ æ¥çš„props *&#x2F;\n    return (\n      &#x2F;&#x2F; eslint-disable-next-line jsx-a11y&#x2F;anchor-is-valid\n      &lt;a\n        &#123;...this.props&#125;\n        onClick&#x3D;&#123;() &#x3D;&gt; &#123;\n          this.props.context.history.push(this.props.to);\n        &#125;&#125;\n      &gt;\n        &#123;this.props.children&#125;\n      &lt;&#x2F;a&gt;\n    );\n  &#125;\n&#125;\n\nexport default Link;\n\n&#x2F;**\n * &lt;a href&#x3D;&#123;&#96;#$&#123;this.props.to&#125;&#96;&#125;&gt;&#123;this.props.children&#125;&lt;&#x2F;a&gt;;\n *&#x2F;\n\nMenuLinkimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Route from &#39;.&#x2F;Route&#39;;\nimport Link from &#39;.&#x2F;Link&#39;;\n&#x2F;**è‡ªå®šä¹‰å¯¼èˆª æ­£å¢åŠ é«˜äº®å±æ€§ *&#x2F;\n\n&#x2F;** Routeæ¸²æŸ“å†…å®¹æœ‰ä¸‰ç§æ–¹æ³• component render children *&#x2F;\n&#x2F;&#x2F; component render è·¯å¾„åŒ¹é…æ¸²æŸ“\n&#x2F;&#x2F; children éƒ½ä¼šæ¸²æŸ“\nfunction MenuLink(&#123; to, exact, children &#125;) &#123;\n  return (\n    &lt;Route\n      path&#x3D;&#123;to&#125;\n      exact&#x3D;&#123;exact&#125;\n      children&#x3D;&#123;(props) &#x3D;&gt; (\n        &lt;li className&#x3D;&#123;props.match ? &#39;active&#39; : &#39;&#39;&#125;&gt;\n          &lt;Link to&#x3D;&#123;to&#125;&gt;&#123;children&#125;&lt;&#x2F;Link&gt;\n        &lt;&#x2F;li&gt;\n      )&#125;\n    &gt;&lt;&#x2F;Route&gt;\n  );\n&#125;\n\nexport default MenuLink;\n\nPromptimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\nclass Prompt extends Component &#123;\n  static contextType &#x3D; Context;\n\n  componentWillUnmount() &#123;\n    this.history.block(null);\n  &#125;\n  render() &#123;\n    let history &#x3D; this.context.history;\n    const &#123; when, messaga &#125; &#x3D; this.props;\n    if (when) &#123;\n      history.block(messaga);\n    &#125; else &#123;\n      history.block(null);\n    &#125;\n\n    return null;\n  &#125;\n&#125;\n\nexport default Prompt;\n\nRedirectimport &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\nclass Redirect extends Component &#123;\n  static contextType &#x3D; Context;\n  render() &#123;\n    this.context.history.push(this.props.to);\n    return null;\n  &#125;\n&#125;\n\nexport default Redirect;\n\nRouteimport PathToRegexp from &#39;path-to-regexp&#39;;\nimport React, &#123; Component &#125; from &#39;react&#39;;\nimport Context from &#39;.&#x2F;context&#39;;\nclass Route extends Component &#123;\n  static contextType &#x3D; Context;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;&#125;;\n  &#125;\n  render() &#123;\n    let &#123; pathname &#125; &#x3D; this.context.location;\n    let &#123;\n      path &#x3D; &#39;&#x2F;&#39;,\n      component: Component,\n      exact &#x3D; false,\n      render,\n      children,\n    &#125; &#x3D; this.props;\n    let paramNames &#x3D; [];\n    let regxp &#x3D; PathToRegexp(path, paramNames, &#123; end: exact &#125;);\n    let result &#x3D; pathname.match(regxp);\n    let props &#x3D; &#123;\n      location: this.context.location,\n      history: this.props.history,\n    &#125;;\n    if (result) &#123;\n      paramNames &#x3D; paramNames.map((item) &#x3D;&gt; item.name);\n      let [url, ...values] &#x3D; result;\n      let params &#x3D; &#123;&#125;;\n      for (let i &#x3D; 0; i &lt; paramNames.length; i++) &#123;\n        params[paramNames[i]] &#x3D; values[i];\n      &#125;\n      props.match &#x3D; &#123; params, path, url, isExect: url &#x3D;&#x3D;&#x3D; pathname &#125;;\n      if (Component) &#123;\n        return &lt;Component &#123;...props&#125; &#x2F;&gt;;\n      &#125; else if (render) &#123;\n        &#x2F;** æ£€æŸ¥å±æ€§ å…¼å®¹æ€§ *&#x2F;\n        return render(props);\n      &#125; else if (children) &#123;\n        return children(props);\n      &#125; else &#123;\n        return null;\n      &#125;\n    &#125; else &#123;\n      if (children) return children(props);\n      else return null;\n    &#125;\n  &#125;\n&#125;\n\nexport default Route;\n\nSwitchimport &#123; Component &#125; from &#39;react&#39;;\nimport PathToRegexp from &#39;path-to-regexp&#39;;\nclass Switch extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;&#125;;\n  &#125;\n  render() &#123;\n    let &#123; pathname &#125; &#x3D; this.context.location;\n    let children &#x3D; Array.isArray(this.props.children)\n      ? this.props\n      : [this.props.children];\n    for (let i &#x3D; 0; i &lt; children.length; i++) &#123;\n      let child &#x3D; children[i];\n      let &#123; path &#x3D; &#39;&#x2F;&#39;, exect &#x3D; false &#125; &#x3D; child.props;\n      let pathNames &#x3D; [];\n      let reg &#x3D; PathToRegexp(path, pathNames, &#123; end: exect &#125;);\n      let result &#x3D; pathname.match(reg);\n      if (result) &#123;\n        return child; &#x2F;** reactçš„å…ƒç´  React.createElement *&#x2F;\n      &#125;\n    &#125;\n    return null;\n  &#125;\n&#125;\n\nexport default Switch;\n\nWithRouterimport React from &#39;react&#39;;\nimport Route from &#39;.&#x2F;Route&#39;;\n\n&#x2F;&#x2F; eslint-disable-next-line import&#x2F;no-anonymous-default-export\nexport default function (WrappedComponent) &#123;\n  return (props) &#x3D;&gt; &lt;Route component&#x3D;&#123;WrappedComponent&#125; &#x2F;&gt;;\n&#125;\n","slug":"react-router-dom","date":"2021-04-06T14:27:28.383Z","categories_index":"React","tags_index":"React,react-router-dom","author_index":"éº¦å½“"},{"id":"fa08fd35cb36d755ed7492a61cf66138","title":"react Hooks","content":"useState\n\næ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é—­åŒ…\næ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæœ‰è‡ªå·±çš„ props å’Œ state\næ¯æ¬¡æ¸²æŸ“åä¼šæœ‰è‡ªå·±çš„æ—¶é—´å¤„ç†å‡½æ•°\n\nfunction Counter() &#123;\n  let [num, setNum] &#x3D; useState(0);\n  function alertNum() &#123;\n    setTimeout(() &#x3D;&gt; &#123;\n      alert(num);\n    &#125;, 3000);\n  &#125;\n  return (\n    &lt;div&gt;\n      &lt;p&gt;&#123;num&#125;&lt;&#x2F;p&gt;\n      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setNum&#125;&gt;&lt;&#x2F;button&gt;\n      &lt;button onClick&#x3D;&#123;alertNum&#125;&gt;alert&lt;&#x2F;button&gt;\n    &lt;&#x2F;div&gt;\n  );\n&#125;\n\nfunction Counter() &#123;\n  let [num, setNum] &#x3D; useState(0);\n  function lazy()&#123;\n    setTimeout((\n      &#x2F;&#x2F; æœ‰å·®åˆ«\n -     setNum(num + 1);\n -     setNum(num &#x3D;&gt; num + 1);\n    )&#x3D;&gt;&#123;&#125;, 3000)\n  &#125;\n  return (\n    &lt;div&gt;\n      &lt;p&gt;&#123;num&#125;&lt;&#x2F;p&gt;\n      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setNum&#125;&gt;&lt;&#x2F;button&gt;\n      &lt;button onClick&#x3D;&#123;lazy&#125;&gt;lazy&lt;&#x2F;button&gt;\n    &lt;&#x2F;div&gt;\n  );\n&#125;\n\næƒ°æ€§åˆå§‹åŒ–\nfunction Counter(props) &#123;\n  let [counter, setCounter] &#x3D; useState(function () &#123;\n    return &#123; num: props.num &#125;;\n  &#125;);\n  return (\n    &lt;div&gt;\n      &lt;p&gt;&#123;counter.num&#125;&lt;&#x2F;p&gt;\n      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCounter&#125;&gt;&lt;&#x2F;button&gt;\n    &lt;&#x2F;div&gt;\n  );\n&#125;\n\nefectæ¯æ¬¡æˆ‘ä»¬é‡æ–°æ¸²æŸ“ éƒ½ä¼šç”Ÿæˆæ–°çš„ effect æ›¿æ¢ä¹‹å‰çš„ effect å±äºæ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ† effect å±äºç‰¹å®šçš„æ¸²æŸ“\n","slug":"react-hook","date":"2021-04-06T14:27:28.370Z","categories_index":"React","tags_index":"React,react hook","author_index":"éº¦å½“"},{"id":"b9a37f021de474295d3010955ace362e","title":"react base","content":"ç”Ÿå‘½å‘¨æœŸ(è€ç‰ˆ)\n\n\nimport React, &#123; Component &#125; from &#39;react&#39;;\n\nclass LifeCycle extends Component &#123;\n  &#x2F;**ç»„ä»¶çš„é™æ€å±æ€§ *&#x2F;\n  static defaultProps &#x3D; &#123; name: &#39;è®¡æ•°å™¨&#39; &#125;;\n  constructor(props) &#123;\n    &#x2F;** setup props and state *&#x2F;\n    super(props);\n    this.state &#x3D; &#123; number: 0 &#125;;\n    console.log(&#39;setup&#39;);\n  &#125;\n  componentWillMount() &#123;\n    console.log(&#39;2 ç»„ä»¶å°†è¦æŒ‚è½½&#39;);\n  &#125;\n  componentDidMount() &#123;\n    console.log(&#39;4.ç»„ä»¶æŒ‚è½½å®Œæˆ&#39;);\n  &#125;\n  shouldComponentUpdate() &#123;\n    console.log(&#39;5. è¯¢é—®ç»„ä»¶æ˜¯å¦è¦æ›´æ–°&#39;);\n    return true;\n  &#125;\n  componentWillUpdate() &#123;\n    console.log(&#39;6 ç»„ä»¶å°†è¦æ›´æ–°&#39;);\n  &#125;\n  componentDidUpdate() &#123;\n    console.log(&#39;7 ç»„ä»¶å·²ç»æ›´æ–°å®Œæ¯•&#39;);\n  &#125;\n  add &#x3D; () &#x3D;&gt; &#123;\n    this.setState(&#123;\n      number: this.state.number + 1,\n    &#125;);\n  &#125;;\n  render() &#123;\n    console.log(&#39;parent render&#39;);\n    return (\n      &lt;div&gt;\n        &lt;p&gt;&#123;this.state.name&#125;&lt;&#x2F;p&gt;\n        &lt;button onClick&#x3D;&#123;this.add&#125;&gt;+&lt;&#x2F;button&gt;\n        &lt;Sub &#x2F;&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nexport default LifeCycle;\n\nclass Sub extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; age: 10 &#125;;\n  &#125;\n  componentWillReceiveProps() &#123;\n    console.log(&#39;componentWillReceiveProps&#39;);\n  &#125;\n  render() &#123;\n    console.log(&#39;children render&#39;);\n    return (\n      &lt;div&gt;\n        &lt;p&gt;age:&#123;this.state.age&#125;&lt;&#x2F;p&gt;\n        &lt;button\n          onClick&#x3D;&#123;() &#x3D;&gt; &#123;\n            this.setState(&#123; age: this.state.age + 1 &#125;);\n          &#125;&#125;\n        &gt;&lt;&#x2F;button&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nç”Ÿå‘½å‘¨æœŸæ–°ç‰ˆ\ngetDerivedStateFromPropsimport React, &#123; Component &#125; from &#39;react&#39;;\nclass Counter extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; number: 0 &#125;;\n  &#125;\n  add &#x3D; () &#x3D;&gt; &#123;\n    this.setState(&#123;\n      number: this.state.number + 1,\n    &#125;);\n  &#125;;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        &lt;p&gt;&#123;this.state.number&#125;&lt;&#x2F;p&gt;\n        &lt;button onClick&#x3D;&#123;this.add&#125;&gt;+&lt;&#x2F;button&gt;\n        &lt;SubCounter number&#x3D;&#123;this.state.number&#125; &#x2F;&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nclass SubCounter extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; number: 0 &#125;;\n  &#125;\n  &#x2F;** å°†Stateå’ŒPropsä¼ æ¥çš„å€¼å…¨éƒ¨æ•´åˆåˆ°stateä¸Š *&#x2F;\n  static getDerivedStateFromProps(nextProps, prevState) &#123;\n    if (nextProps.number % 2 &#x3D;&#x3D;&#x3D; 0) &#123;\n      return &#123; number: nextProps.number * 2 &#125;;\n    &#125; else &#123;\n      return &#123; number: nextProps.number * 3 &#125;;\n    &#125;\n  &#125;\n  render() &#123;\n    return &lt;div&gt;&#123;this.state.number&#125;&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nexport default Counter;\n\ngetSnapshotBeforeUpdateimport React, &#123; Component &#125; from &#39;react&#39;;\nclass getSnapshotBeforeUpdateComponent extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.wrapper &#x3D; React.createRef();\n    this.state &#x3D; &#123; message: [&#39;5&#39;, &#39;4&#39;, &#39;3&#39;, &#39;2&#39;, &#39;1&#39;] &#125;;\n  &#125;\n\n  componentDidMount() &#123;\n    setInterval(() &#x3D;&gt; &#123;\n      this.setState(&#123;\n        message: [this.state.message.length, ...this.state.message],\n      &#125;);\n    &#125;, 1000);\n  &#125;\n\n  getSnapshotBeforeUpdate() &#123;\n    return this.wrapper.current.scrollHeight;\n  &#125;\n  componentDidUpdate(prevProps, prevState, scrollHeight) &#123;\n    let Dom &#x3D; this.wrapper.current;\n    Dom.scrollTop &#x3D; Dom.scrollTop + (Dom.scrollHeight - scrollHeight);\n  &#125;\n  render() &#123;\n    let style &#x3D; &#123;\n      height: &#39;100p&#39;,\n      width: &#39;200px&#39;,\n      border: &#39;1px solid red&#39;,\n      overflow: &#39;auto&#39;,\n    &#125;;\n    return (\n      &lt;div style&#x3D;&#123;style&#125; ref&#x3D;&#123;this.wrapper&#125;&gt;\n        &lt;ul&gt;\n          &#123;this.state.message.map((item, index) &#x3D;&gt; &#123;\n            return &lt;li key&#x3D;&#123;index&#125;&gt;&#123;item&#125;&lt;&#x2F;li&gt;;\n          &#125;)&#125;\n        &lt;&#x2F;ul&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nexport default getSnapshotBeforeUpdateComponent;\n\ncontext(ä¸Šä¸‹æ–‡)æ—§ç‰ˆimport React, &#123; Component &#125; from &#39;react&#39;;\nimport propTypes from &#39;prop-types&#39;;\nclass Page extends Component &#123;\n  static childContextTypes &#x3D; &#123;\n    color: propTypes.string,\n    setColor: propTypes.func,\n  &#125;;\n  getChildContext() &#123;\n    return &#123; color: &#39;gray&#39;, setColor: this.setColor &#125;;\n  &#125;\n\n  setColor &#x3D; (color) &#x3D;&gt; &#123;\n    this.setColor(&#123; color &#125;);\n  &#125;;\n  constructor() &#123;\n    super();\n    this.state &#x3D; &#123; color: &#39;gray&#39; &#125;;\n  &#125;\n  render() &#123;\n    return (\n      &lt;&gt;\n        &lt;Header&gt;\n          &lt;Title&gt;&lt;&#x2F;Title&gt;\n        &lt;&#x2F;Header&gt;\n        &lt;Main&gt;\n          &lt;Content&gt;&lt;&#x2F;Content&gt;\n        &lt;&#x2F;Main&gt;\n      &lt;&#x2F;&gt;\n    );\n  &#125;\n&#125;\n\nclass Header extends Component &#123;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        Header\n        &lt;Title&gt;&lt;&#x2F;Title&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nclass Title extends Component &#123;\n  &#x2F;** å­é›†å…³ç³» *&#x2F;\n  static contextTypes &#x3D; &#123;\n    color: propTypes.string,\n    setColor: propTypes.func,\n  &#125;;\n  &#x2F;**\n   * this.context.color\n   * this.context.setColor\n   *&#x2F;\n\n  render() &#123;\n    return &lt;div&gt;Title&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nclass Main extends Component &#123;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        Main\n        &lt;Content&gt;&lt;&#x2F;Content&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nclass Content extends Component &#123;\n  render() &#123;\n    return &lt;div&gt;Content&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nexport default Page;\n\næ–°ç‰ˆ&#x2F;&#x2F; import &#123; func &#125; from &#39;prop-types&#39;;\nimport React, &#123; Component &#125; from &#39;react&#39;;\n&#x2F;&#x2F; import propTypes from &#39;prop-types&#39;;\nconst ThemeContext &#x3D; React.createContext();\n&#x2F;**\n * ThemeContext &#x3D; &#123;Provider Consumer&#125;\n *\n *&#x2F;\n\n&#x2F;**-------- createContext -----------------------------------*&#x2F;\n\nfunction createContext() &#123;\n  class Provider extends Component &#123;\n    static value;\n    constructor(props) &#123;\n      super(props);\n      Provider.value &#x3D; props.value;\n    &#125;\n    render() &#123;\n      return this.props.children;\n    &#125;\n  &#125;\n\n  class Consumer extends Component &#123;\n    render() &#123;\n      return this.props.children(Provider.value);\n    &#125;\n  &#125;\n\n  return &#123; Provider, Consumer &#125;;\n&#125;\n\n&#x2F;**----------------------------------------------------------- *&#x2F;\n\nclass Page extends Component &#123;\n  constructor() &#123;\n    super();\n    this.state &#x3D; &#123; color: &#39;gray&#39; &#125;;\n  &#125;\n  setColor(color) &#123;\n    this.setState(&#123; color &#125;);\n  &#125;\n  render() &#123;\n    let ctx &#x3D; &#123; color: &#39;gray&#39;, setColor: this.setColor &#125;;\n    return (\n      &lt;ThemeContext.Provider value&#x3D;&#123;ctx&#125;&gt;\n        &lt;Header&gt;\n          &lt;Title&gt;&lt;&#x2F;Title&gt;\n        &lt;&#x2F;Header&gt;\n        &lt;Main&gt;\n          &lt;Content&gt;&lt;&#x2F;Content&gt;\n        &lt;&#x2F;Main&gt;\n      &lt;&#x2F;ThemeContext.Provider&gt;\n    );\n  &#125;\n&#125;\n\nclass Header extends Component &#123;\n  &#x2F;**----------------------------------------------- *&#x2F;\n  static contextType &#x3D; ThemeContext;\n  &#x2F;**----------------------------------------------- *&#x2F;\n\n  &#x2F;**\n   * this.context æ‹¿åˆ°äº†æ‰€æœ‰çš„å€¼\n   *&#x2F;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        Header\n        &lt;Title&gt;&lt;&#x2F;Title&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nfunction Title(props) &#123;\n  return &lt;div&gt;title&lt;&#x2F;div&gt;;\n&#125;\n\nclass Main extends Component &#123;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        Main\n        &lt;Content&gt;&lt;&#x2F;Content&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nclass Content extends Component &#123;\n  render() &#123;\n    return &lt;div&gt;Content&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nexport default Page;\n\npureComponentimport React, &#123; PureComponent &#125; from &#39;react&#39;;\n\nclass Title extends PureComponent &#123;\n  render() &#123;\n    return &lt;div&gt;&#123;this.props.title&#125;&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nclass Counter extends PureComponent &#123;\n  render() &#123;\n    return &lt;div&gt;&#123;this.props.number&#125;&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nexport default class App extends PureComponent &#123;\n  constructor(props) &#123;\n    super(props);\n    this.props &#x3D; props;\n    this.state &#x3D; &#123; title: &#39;è®¡æ•°å™¨&#39;, number: 0 &#125;;\n    this.inputRef &#x3D; React.createRef();\n  &#125;\n  add &#x3D; () &#x3D;&gt; &#123;\n    this.setState(&#123;\n      number: this.state.number + parseInt(this.inputRef.current.value),\n    &#125;);\n  &#125;;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        &lt;Title title&#x3D;&#123;this.state.title&#125; &#x2F;&gt;\n        &lt;Counter number&#x3D;&#123;this.state.number&#125; &#x2F;&gt;\n        &lt;input ref&#x3D;&#123;inputRef&#125; &#x2F;&gt;\n        &lt;button onClick&#x3D;&#123;this.add&#125;&gt;+&lt;&#x2F;button&gt;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nimport React, &#123; Component &#125; from &#39;react&#39;;\n\nexport default class PureComponent extends Component &#123;\n  isPureComponent &#x3D; true;\n  shouldComponentUpdate(nextProps, nextState) &#123;\n    return (\n      !shallowEqual(this.props, nextProps) ||\n      !shallowEqual(this.state, nextState)\n    );\n  &#125;\n  render() &#123;\n    return &lt;div&gt;1&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nfunction shallowEqual(obj1, obj2) &#123;\n  if (obj1 &#x3D;&#x3D;&#x3D; obj2) return true;\n  if (\n    typeof obj1 !&#x3D;&#x3D; &#39;object&#39; ||\n    obj1 &#x3D;&#x3D;&#x3D; null ||\n    typeof obj2 !&#x3D;&#x3D; &#39;object&#39; ||\n    obj2 &#x3D;&#x3D;&#x3D; null\n  ) &#123;\n    return false;\n  &#125;\n\n  let keys1 &#x3D; Object.keys(obj1);\n  let keys2 &#x3D; Object.keys(obj2);\n  if (keys1.length !&#x3D;&#x3D; keys2.length) return false;\n\n  for (let key of keys1) &#123;\n    if (!obj2.hasOwnProperty(key)) &#123;\n      if (obj1[key] !&#x3D;&#x3D; obj2[key]) &#123;\n        if (typeof obj1[key] &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; typeof obj2[key] &#x3D;&#x3D;&#x3D; &#39;object&#39;) &#123;\n          return shallowEqual(obj1[key], obj2[key]);\n        &#125;\n      &#125; else &#123;\n        return false;\n      &#125;\n    &#125;\n  &#125;\n  return true;\n&#125;\n\nmemoimport React, &#123; PureComponent &#125; from &#39;react&#39;;\n\nfunction memo(FunComponent) &#123;\n  return class Proxy extends PureComponent &#123;\n    render() &#123;\n      return FunComponent(this.props)\n    &#125;\n  &#125;;\n&#125;\nexport default memo;\n\n\né«˜é˜¶ç»„ä»¶&#x2F;**\n * é«˜é˜¶å‡½æ•° ä¼ å…¥ä¸€ä¸ªå‡½æ•° è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°\n * é«˜é˜¶ç»„ä»¶ ä¼ å…¥ä¸€ä¸ªç»„ä»¶ è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶\n *&#x2F;\n\nimport React from &#39;react&#39;;\nexport default function withLogger(Comp) &#123;\n  return class extends React.Component &#123;\n    componentWillMount() &#123;\n      this.start &#x3D; Date.now();\n    &#125;\n    componentDidMount() &#123;\n      console.log(Date.now() - this.start + &#39;ms&#39;);\n    &#125;\n\n    render() &#123;\n      return &lt;Comp &#123;...this.props&#125; &#x2F;&gt;;\n    &#125;\n  &#125;;\n&#125;\n\n\nrender props&lt;MouseTracker&gt;\n\t&#123;\n        (props)&#x3D;&gt;&lt;Pirture &#123;...props&#125;&#x2F;&gt;\n    &#125;\n&lt;&#x2F;MouseTracker&gt;\n\n\nimport React, &#123; Component &#125; from &#39;react&#39;;\nclass MouseTracker extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; x: 0, y: 0 &#125;;\n  &#125;\n  handleMouseMove &#x3D; (event) &#x3D;&gt; &#123;\n    this.setState(&#123;\n      x: event.clientX,\n      y: event.clientY,\n    &#125;);\n  &#125;;\n  render() &#123;\n    return (\n      &lt;div onMouseOver&#x3D;&#123;this.handleMouseMove&#125;&gt;\n            &#x2F;* æ‰§è¡Œå­ç»„ä»¶ å‡½æ•°ç»„ä»¶*&#x2F;\n        &#123;this.props.children(&#123; x: this.state.x, y: this.state.y &#125;)&#125;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nexport default MouseTracker;\n\n\nFrament&lt;React.Fragment&gt;\n\nprotalimport React, &#123; Component &#125; from &#39;react&#39;;\nimport ReactDOM from &#39;react-dom&#39;;\nclass Modal extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.modal &#x3D; document.getElementById(&#39;modal-root&#39;);\n  &#125;\n  render() &#123;\n    return ReactDOM.createPortal(this.props.children, this.modal);\n  &#125;\n&#125;\n\nclass Page extends Component &#123;\n  constructor(prop) &#123;\n    super(prop);\n    this.state &#x3D; &#123; show: false &#125;;\n  &#125;\n  toggleModal &#x3D; () &#x3D;&gt; &#123;\n    this.setState(&#123;\n      show: !this.state.show,\n    &#125;);\n  &#125;;\n  render() &#123;\n    return (\n      &lt;div&gt;\n        &lt;button onClick&#x3D;&#123;this.toggleModal&#125;&gt;å…³é—­&#x2F;æ˜¾ç¤º&lt;&#x2F;button&gt;\n        &#123;this.state.show &amp;&amp; (\n          &lt;Modal&gt;\n            &lt;div id&#x3D;&#39;modal&#39; className&#x3D;&#39;modal&#39;&gt;\n              &lt;div id&#x3D;&#39;content&#39; className&#x3D;&#39;content&#39;&gt;\n                Modal\n              &lt;&#x2F;div&gt;\n            &lt;&#x2F;div&gt;\n          &lt;&#x2F;Modal&gt;\n        )&#125;\n      &lt;&#x2F;div&gt;\n    );\n  &#125;\n&#125;\n\nexport default Page;\n\né”™è¯¯è¾¹ç•Œimport React, &#123; Component &#125; from &#39;react&#39;;\nclass ErrorBoundary extends Component &#123;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123; hasErrors: false &#125;;\n  &#125;\n  &#x2F;* æ•è·å¼‚å¸¸ æ£€æŸ¥é”™è¯¯*&#x2F;\n  componentDidCatch(err, info) &#123;\n    if (err) &#123;\n      this.setState(&#123;\n        hasErrors: true,\n      &#125;);\n    &#125;\n  &#125;\n  render() &#123;\n    if (this.state.hasErrors) &#123;\n      return &lt;div&gt; error&lt;&#x2F;div&gt;;\n    &#125; else &#123;\n      return this.props.children;\n    &#125;\n  &#125;\n&#125;\n\nclass Clock extends Component &#123;\n  render() &#123;\n    return &lt;div&gt;&#123;Date.now()&#125;&lt;&#x2F;div&gt;;\n  &#125;\n&#125;\n\nclass page extends Component &#123;\n  render() &#123;\n    return (\n      &lt;ErrorBoundary&gt;\n        &lt;Clock &#x2F;&gt;\n      &lt;&#x2F;ErrorBoundary&gt;\n    );\n  &#125;\n&#125;\n\nexport default page;\n","slug":"react-base","date":"2021-04-06T14:27:28.342Z","categories_index":"React","tags_index":"React","author_index":"éº¦å½“"},{"id":"764ea20144bdcb36de34ee7af78c0567","title":"proxy åŸºç¡€å­¦ä¹ ","content":"ä»£ç†åŸºç¡€ä»€ä¹ˆæ˜¯ä»£ç†\nä»£ç†æ˜¯ç›®æ ‡å¯¹è±¡çš„æŠ½è±¡ï¼Œç±»ä¼¼äº c++çš„æŒ‡é’ˆï¼Œå¯ä»¥ç”¨ä½œç›®æ ‡çš„æ›¿èº«ï¼Œåˆç‹¬ç«‹ç›®æ ‡ä¹‹å¤–ã€‚\n\n\nconst target &#x3D; &#123;\n  id: &#39;target&#39;,\n&#125;;\n\nconst handler &#x3D; &#123;&#125;;\n\nconst proxy &#x3D; new Proxy(target, handler);\n\nconsole.log(proxy.id);\n\n&#x2F;&#x2F; proxyçš„prototypeæ˜¯undefined\n\nå®šä¹‰æ•è·å™¨\nconst target &#x3D; &#123;\n  id: &#39;target&#39;,\n&#125;;\n\nconst handler &#x3D; &#123;\n  get() &#123;\n    return &#39;handler override&#39;;\n  &#125;,\n&#125;;\n\nconst proxy &#x3D; new Proxy(target, handler);\n\nconsole.log(proxy.id);\n&#x2F;&#x2F; åªæœ‰ä»£ç†æ‰ä¼šäº§ç”Ÿæ•è· åŸæ¥çš„ç›®æ ‡æ²¡æœ‰è¿™æ ·çš„è¡Œä¸º\n\nåå°„ API\nconst target &#x3D; &#123;\n  id: &#39;target&#39;,\n&#125;;\n\nconst handler &#x3D; &#123;\n  get() &#123;\n    console.log(&#39;get handler&#39;);\n    return Reflect.get(...arguments);\n  &#125;,\n&#125;;\n\nconst proxy &#x3D; new Proxy(target, handler);\n\nconsole.log(&#39;----------&#39;, proxy.id);\n\næ•è·å™¨ä¸å˜å¼\nconst target &#x3D; &#123;&#125;;\nObject.defineProperty(target, &#39;foo&#39;, &#123;\n  configurable: false,\n  writable: false,\n  value: &#39;bar&#39;,\n&#125;);\nconst handler &#x3D; &#123;\n  get() &#123;\n    return &#39;qux&#39;;\n  &#125;,\n&#125;;\nconst proxy &#x3D; new Proxy(target, handler);\nconsole.log(proxy.foo);\n\næ’¤é”€ä»£ç†\nconst target &#x3D; &#123;\n  foo: &#39;bar&#39;,\n&#125;;\nconst handler &#x3D; &#123;\n  get() &#123;\n    return &#39;intercepted&#39;;\n  &#125;,\n&#125;;\nconst &#123; proxy, revoke &#125; &#x3D; Proxy.revocable(target, handler);\nconsole.log(proxy.foo); &#x2F;&#x2F; intercepted\nconsole.log(target.foo); &#x2F;&#x2F; bar\nrevoke();\nconsole.log(proxy.foo); &#x2F;&#x2F; TypeError\n\n**å®ç”¨åå°„ API **\n&#x2F;&#x2F; å¾ˆå¤šåå°„æ–¹æ³•è¿”å›ç§°ä½œâ€œçŠ¶æ€æ ‡è®°â€çš„å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ„å›¾æ‰§è¡Œçš„æ“ä½œæ˜¯å¦æˆåŠŸ\nconst o &#x3D; &#123;&#125;;\ntry &#123;\n  Object.defineProperty(o, &#39;foo&#39;, &#39;bar&#39;);\n  console.log(&#39;success&#39;);\n&#125; catch (e) &#123;\n  console.log(&#39;failure&#39;);\n&#125;\n&#x2F;&#x2F; ä½¿ç”¨ä»£ç†ä¹‹å\n&#x2F;&#x2F; åœ¨å®šä¹‰æ–°å±æ€§æ—¶å¦‚æœå‘ç”Ÿé—®é¢˜ï¼ŒReflect.defineProperty()ä¼šè¿”å› falseï¼Œè€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ã€‚\n&#x2F;&#x2F; å› æ­¤ä½¿ç”¨è¿™ä¸ªåå°„æ–¹æ³•å¯ä»¥è¿™æ ·é‡æ„ä¸Šé¢çš„ä»£ç ï¼š\n&#x2F;&#x2F; é‡æ„åçš„ä»£ç \nconst o &#x3D; &#123;&#125;;\nif (Reflect.defineProperty(o, &#39;foo&#39;, &#123; value: &#39;bar&#39; &#125;)) &#123;\n  console.log(&#39;success&#39;);\n&#125; else &#123;\n  console.log(&#39;failure&#39;);\n&#125;\n\nå…¶ä»–çš„çŠ¶æ€æ ‡è®°åå°„ API\nReflect.defineProperty();\nReflect.preventExtensions();\nReflect.setPrototypeOf();\nReflect.set();\nReflect.deleteProperty();\n\nç”¨ä¸€ç­‰å‡½æ•°æ›¿ä»£æ“ä½œç¬¦\nä»¥ä¸‹åå°„æ–¹æ³•æä¾›åªæœ‰é€šè¿‡æ“ä½œç¬¦æ‰èƒ½å®Œæˆçš„æ“ä½œã€‚\nReflect.get()ï¼šå¯ä»¥æ›¿ä»£å¯¹è±¡å±æ€§è®¿é—®æ“ä½œç¬¦ã€‚\nReflect.set()ï¼šå¯ä»¥æ›¿ä»£=èµ‹å€¼æ“ä½œç¬¦ã€‚\nReflect.has()ï¼šå¯ä»¥æ›¿ä»£ in æ“ä½œç¬¦æˆ– with()ã€‚\nReflect.deleteProperty()ï¼šå¯ä»¥æ›¿ä»£ delete æ“ä½œç¬¦ã€‚\nReflect.construct()ï¼šå¯ä»¥æ›¿ä»£ new æ“ä½œç¬¦ã€‚\nä»£ç†çš„é—®é¢˜\nconst wm &#x3D; new WeakMap();\n\nclass User &#123;\n\n constructor(userId) &#123;\n\n \twm.set(this, userId);\n\n &#125;\n\n set id(userId) &#123;\n\n \twm.set(this, userId);\n\n &#125;\n\n get id() &#123;\n\n \treturn wm.get(this);\n\n &#125;\n\n&#125;\n\nç”±äºè¿™ä¸ªå®ç°ä¾èµ– User å®ä¾‹çš„å¯¹è±¡æ ‡è¯†ï¼Œåœ¨è¿™ä¸ªå®ä¾‹è¢«ä»£ç†çš„æƒ…å†µä¸‹å°±ä¼šå‡ºé—®é¢˜ï¼š\n\nconst user &#x3D; new User(123);\n\nconsole.log(user.id); &#x2F;&#x2F; 123\n\nconst userInstanceProxy &#x3D; new Proxy(user, &#123;&#125;);\n\nconsole.log(userInstanceProxy.id); &#x2F;&#x2F; undefined\n\n&#x2F;&#x2F; è¿™æ˜¯å› ä¸º User å®ä¾‹ä¸€å¼€å§‹ä½¿ç”¨ç›®æ ‡å¯¹è±¡ä½œä¸º WeakMap çš„é”®ï¼Œä»£ç†å¯¹è±¡å´å°è¯•ä»è‡ªèº«å–å¾—è¿™ä¸ªå®\n\n&#x2F;&#x2F; ä¾‹ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦é‡æ–°é…ç½®ä»£ç†ï¼ŒæŠŠä»£ç† User å®ä¾‹æ”¹ä¸ºä»£ç† User ç±»æœ¬èº«ã€‚ä¹‹åå†åˆ›å»ºä»£\n\n&#x2F;&#x2F; ç†çš„å®ä¾‹å°±ä¼šä»¥ä»£ç†å®ä¾‹ä½œä¸º WeakMap çš„é”®äº†ï¼š\n\nconst UserClassProxy &#x3D; new Proxy(User, &#123;&#125;);\n\nconst proxyUser &#x3D; new UserClassProxy(456);\n\nconsole.log(proxyUser.id);  &#x2F;&#x2F;\n\nä»£ç†ä¸å†…éƒ¨æ§½ä½\n&#x2F;*\nä»£ç†ä¸å†…ç½®å¼•ç”¨ç±»å‹ï¼ˆæ¯”å¦‚ Arrayï¼‰çš„å®ä¾‹é€šå¸¸å¯ä»¥å¾ˆå¥½åœ°ååŒï¼Œä½†æœ‰äº› ECMAScript å†…ç½®ç±»å‹å¯\nèƒ½ä¼šä¾èµ–ä»£ç†æ— æ³•æ§åˆ¶çš„æœºåˆ¶ï¼Œç»“æœå¯¼è‡´åœ¨ä»£ç†ä¸Šè°ƒç”¨æŸäº›æ–¹æ³•ä¼šå‡ºé”™ã€‚\nä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ Date ç±»å‹ã€‚æ ¹æ® ECMAScript è§„èŒƒï¼ŒDate ç±»å‹æ–¹æ³•çš„æ‰§è¡Œä¾èµ– this å€¼ä¸Šçš„\nå†…éƒ¨æ§½ä½[[NumberDate]]ã€‚ä»£ç†å¯¹è±¡ä¸Šä¸å­˜åœ¨è¿™ä¸ªå†…éƒ¨æ§½ä½ï¼Œè€Œä¸”è¿™ä¸ªå†…éƒ¨æ§½ä½çš„å€¼ä¹Ÿä¸èƒ½é€šè¿‡æ™®é€š\nçš„ get()å’Œ set()æ“ä½œè®¿é—®åˆ°ï¼Œäºæ˜¯ä»£ç†æ‹¦æˆªåæœ¬åº”è½¬å‘ç»™ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ä¼šæŠ›å‡º TypeErrorï¼š\n*&#x2F;\nconst target &#x3D; new Date();\nconst proxy &#x3D; new Proxy(target, &#123;&#125;);\nconsole.log(proxy instanceof Date); &#x2F;&#x2F; true\nproxy.getDate(); &#x2F;&#x2F; TypeError: &#39;this&#39; is not a Date object\n\nä»£ç†æ•è·å™¨get()\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  get(target, property, receiver) &#123;\n    console.log(&#39;get()&#39;);\n    return Reflect.get(...arguments);\n  &#125;,\n&#125;);\nproxy.foo;\n\næ‹¦æˆªçš„æ“ä½œ\n\nproxy.property\nproxy[property]\nObject.create(proxy)[property]\nReflect.get(proxy, property, receiver)\n\nset\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  set(target, property, value, receiver) &#123;\n    console.log(&#39;set()&#39;);\n    return Reflect.set(...arguments);\n  &#125;,\n&#125;);\nproxy.foo &#x3D; &#39;bar&#39;;\n&#x2F;&#x2F; è¿”å› true è¡¨ç¤ºæˆåŠŸï¼›è¿”å› false è¡¨ç¤ºå¤±è´¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º TypeErrorã€‚\n\næ‹¦æˆªçš„æ“ä½œ\n\nproxy.property = value\nproxy[property] = value\nObject.create(proxy)[property] = value\nReflect.set(proxy, property, value, receiver)\n\nhas\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  has(target, property) &#123;\n    console.log(&#39;has()&#39;);\n    return Reflect.has(...arguments);\n  &#125;,\n&#125;);\n&#39;foo&#39; in proxy;\n&#x2F;&#x2F; has()\n\n\nproperty in proxy\nproperty in Object.create(proxy)\nwith(proxy) {(property);}\nReflect.has(proxy, property)\n\ndefineProperty()\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  defineProperty(target, property, descriptor) &#123;\n    console.log(&#39;defineProperty()&#39;);\n    return Reflect.defineProperty(...arguments);\n  &#125;,\n&#125;);\nObject.defineProperty(proxy, &#39;foo&#39;, &#123; value: &#39;bar&#39; &#125;);\n&#x2F;&#x2F; Object.defineProperty(proxy, property, descriptor)\n&#x2F;&#x2F; Reflect.defineProperty(proxy, property, descriptor)\n\ngetOwnPropertyDescriptor\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  getOwnPropertyDescriptor(target, property) &#123;\n    console.log(&#39;getOwnPropertyDescriptor()&#39;);\n    return Reflect.getOwnPropertyDescriptor(...arguments);\n  &#125;,\n&#125;);\nObject.getOwnPropertyDescriptor(proxy, &#39;foo&#39;);\n&#x2F;&#x2F; getOwnPropertyDescriptor()\n\n&#x2F;&#x2F; Object.getOwnPropertyDescriptor(proxy, property)\n&#x2F;&#x2F; Reflect.getOwnPropertyDescriptor(proxy, property)\n\ndeleteProperty\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  deleteProperty(target, property) &#123;\n    console.log(&#39;deleteProperty()&#39;);\n    return Reflect.deleteProperty(...arguments);\n  &#125;,\n&#125;);\ndelete proxy.foo;\n&#x2F;&#x2F; deleteProperty()\n&#x2F;*\n    delete proxy.property\n    delete proxy[property]\n    Reflect.deleteProperty(proxy, property)\n*&#x2F;\n\nownKeys\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  ownKeys(target) &#123;\n    console.log(&#39;ownKeys()&#39;);\n    return Reflect.ownKeys(...arguments);\n  &#125;,\n&#125;);\nObject.keys(proxy);\n&#x2F;&#x2F; ownKeys()\n&#x2F;*\n    Object.getOwnPropertyNames(proxy)\n    Object.getOwnPropertySymbols(proxy)\n    Object.keys(proxy)\n    Reflect.ownKeys(proxy)\n*&#x2F;\n\ngetPrototypeOf\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  getPrototypeOf(target) &#123;\n    console.log(&#39;getPrototypeOf()&#39;);\n    return Reflect.getPrototypeOf(...arguments);\n  &#125;,\n&#125;);\nObject.getPrototypeOf(proxy);\n&#x2F;&#x2F; getPrototypeOf()\n\n&#x2F;*\n    Object.getPrototypeOf(proxy)\n    Reflect.getPrototypeOf(proxy)\n    proxy.__proto__\n    Object.prototype.isProt\n*&#x2F;\n\nsetPrototypeOf\nconst myTarget &#x3D; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  setPrototypeOf(target, prototype) &#123;\n    console.log(&#39;setPrototypeOf()&#39;);\n    return Reflect.setPrototypeOf(...arguments);\n  &#125;,\n&#125;);\nObject.setPrototypeOf(proxy, Object);\n&#x2F;&#x2F; setPrototypeOf()\n\n&#x2F;*\n    Object.setPrototypeOf(proxy)\n    Reflect.setPrototypeOf(proxy)\n*&#x2F;\n\nisExtensible\npreventExtensions\napply\nconst myTarget &#x3D; () &#x3D;&gt; &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  apply(target, thisArg, ...argumentsList) &#123;\n    console.log(&#39;apply()&#39;);\n    return Reflect.apply(...arguments);\n  &#125;,\n&#125;);\nproxy();\n&#x2F;*\n    proxy(...argumentsList)\n    Function.prototype.apply(thisArg, argumentsList)\n    Function.prototype.call(thisArg, ...argumentsList)\n    Reflect.apply(target, thisArgument, argumentsList)\n*&#x2F;\n\nconstruct\nconst myTarget &#x3D; function () &#123;&#125;;\nconst proxy &#x3D; new Proxy(myTarget, &#123;\n  construct(target, argumentsList, newTarget) &#123;\n    console.log(&#39;construct()&#39;);\n    return Reflect.construct(...arguments);\n  &#125;,\n&#125;);\nnew proxy();\n&#x2F;&#x2F; construct()\n&#x2F;*\n    new proxy(...argumentsList)\n    Reflect.construct(target, argumentsList, newTarget)\n*&#x2F;\n","slug":"proxy","date":"2021-04-06T14:27:28.313Z","categories_index":"JavaScript","tags_index":"JavaScript","author_index":"éº¦å½“"},{"id":"3a1de7864b72f88f991d2ad903723f46","title":"connected-react-router","content":"index.js\n\nimport routerMiddlware from &#39;.&#x2F;routerMiddlware&#39;;\nimport connectRouter from &#39;.&#x2F;connectRouter&#39;;\nimport push from &#39;.&#x2F;push&#39;;\nimport ConnectedRouter from &#39;.&#x2F;ConnectedRouter&#39;;\nexport &#123; routerMiddlware, connectRouter, push, ConnectedRouter &#125;;\n\n\n\nconstantsexport const CALL_HISTORY_METHOD &#x3D; &#39;@@router&#x2F;CALL_HISTORY_METHOD&#39;;\nexport const LOCATION_CHANGE &#x3D; &#39;@@router&#x2F;LOCATION_CHANGE&#39;;\n\nConnectedRouter.jsimport React, &#123; Component &#125; from &#39;react&#39;;\nimport &#123; ReactReduxContext &#125; from &#39;react-redux&#39;;\nimport &#123; Route &#125; from &#39;react-router&#39;;\nimport &#123; LOCATION_CHANGE &#125; from &#39;.&#x2F;constants&#39;;\nclass ConnectedRouter extends Component &#123;\n  static contextType &#x3D; ReactReduxContext;\n  constructor(props) &#123;\n    super(props);\n    this.state &#x3D; &#123;&#125;;\n  &#125;\n  componentDidMount() &#123;\n    &#x2F;&#x2F; location æ–°çš„è·¯å¾„\n    &#x2F;&#x2F; action æ–°çš„åŠ¨ä½œ POP PUSH\n    this.unlistener &#x3D; this.props.history.listen((location, action) &#x3D;&gt; &#123;\n      this.context.store.dispatch(&#123;\n        type: LOCATION_CHANGE,\n        payload: &#123; location, action &#125;,\n      &#125;);\n    &#125;);\n  &#125;\n  componentWillUnmount() &#123;\n    this.unlistener();\n  &#125;\n  render() &#123;\n    let &#123; history, children &#125; &#x3D; this.props;\n    return &lt;Route history&#x3D;&#123;history&#125;&gt;&#123;children&#125;&lt;&#x2F;Route&gt;;\n  &#125;\n&#125;\n\nexport default ConnectedRouter;\n\nconnectRouter.jsimport &#123; LOCATION_CHANGE &#125; from &#39;.&#x2F;constants&#39;;\n&#x2F;&#x2F; eslint-disable-next-line import&#x2F;no-anonymous-default-export\nexport default function (history) &#123;\n  let initialState &#x3D; &#123; action: history.action, location: history.location &#125;;\n  return function (state &#x3D; initialState, action) &#123;\n    switch (action.type) &#123;\n      case LOCATION_CHANGE:\n        return action.payload;\n      default:\n        return state;\n    &#125;\n  &#125;;\n&#125;\n\npushimport &#123; CALL_HISTORY_METHOD &#125; from &#39;.&#x2F;constants&#39;;\nfunction push(path) &#123;\n  return &#123;\n    type: CALL_HISTORY_METHOD,\n    payload: &#123;\n      method: &#39;push&#39;,\n      path,\n    &#125;,\n  &#125;;\n&#125;\n\nexport default push;\n\nrouterMiddleware.jsimport &#123; CALL_HISTORY_METHOD &#125; from &#39;.&#x2F;constants&#39;;\n&#x2F;&#x2F; eslint-disable-next-line import&#x2F;no-anonymous-default-export\nexport default function (history) &#123;\n  return (&#123; dispatch, getState &#125;) &#x3D;&gt; (next) &#x3D;&gt; (action) &#x3D;&gt; &#123;\n    if (action.type &#x3D;&#x3D;&#x3D; CALL_HISTORY_METHOD) &#123;\n      let &#123; method, path &#125; &#x3D; action.payload;\n      history[method](path);\n    &#125; else &#123;\n      next();\n    &#125;\n  &#125;;\n&#125;\n","slug":"connected-react-router","date":"2021-04-06T14:27:28.294Z","categories_index":"React","tags_index":"React","author_index":"éº¦å½“"},{"id":"46450d7ba5c2c45a066c1b2bc4af0876","title":"leetcodeå­¦ä¹ è®°å½•","content":"\næˆ‘æ˜¯ä¸€ä¸ªç®—æ³•çš„èœé¸Ÿï¼Œåœ¨é¢è¯•çš„æ—¶å€™ç»å¸¸è¢«ç®—æ³•ç»Šå€’åœ¨é—¨æ§›ã€‚è¿™ç¯‡æ–‡ç« å°±æ˜¯è®°å½•è‡ªå·±åˆ· leetcode çš„è¿‡ç¨‹ï¼Œè®°ä¸‹æ¥è‡ªå·±å¯¹æ¯ä¸ªé—®é¢˜çš„ç†è§£å’Œæƒ³æ³•ï¼ŒæŠŠå¥½çš„æƒ³æ³•è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›è¯»è€…æœ‰å¸®åŠ©ã€‚å¸Œæœ›è‡ªå·±å¯ä»¥åšæŒä¸‹å»ï¼Œä¸€å¤©å†™ä¸€é“é¢˜ï¼Œä¿æŒè‡ªå·±å¯¹ç®—æ³•çš„æ•æ„Ÿåº¦ï¼Œä¿æŒæ€è€ƒã€‚ä¸€èµ·åŠ æ²¹ï¼ï¼ï¼\n\n134 åŠ æ²¹ç«™åˆ†æ\n\n\næšä¸¾æ¯ä¸ªç«™ç‚¹ ç„¶åå°è¯•ä»è¿™ä¸ªç«™ç‚¹èµ°næ¬¡, å¦‚æœå¯ä»¥é¡ºåˆ©èµ°äº†n æ¬¡çš„è¯ å°±æ˜¯å¯ä»¥ç»•ä¸€å‘¨ï¼Œå°±æ˜¯é¢˜è§£ï¼Œå¦‚æœå¦‚æœä¸­é€”ä¸å¯ä»¥ç»§ç»­èµ°ä¸‹å»äº†ï¼Œé‚£ä¸ª i-j ä¸­çš„å­é›†éƒ¨åˆ†ä¹Ÿä¸å¯èƒ½èµ°ä¸‹å»äº†ã€‚æ—¶é—´å¤æ‚åº¦:O(n)ç©ºé—´å¤æ‚åº¦:O(1)\n\né¢˜è§£&#x2F;**\n * @param &#123;number[]&#125; gas\n * @param &#123;number[]&#125; cost\n * @return &#123;number&#125;\n *&#x2F;\nvar canCompleteCircuit &#x3D; function (gas, cost) &#123;\n  let n &#x3D; gas.length;\n\n  let i, j;\n  for (i &#x3D; 0; i &lt; n; ) &#123;\n    let left &#x3D; 0;\n\n    for (j &#x3D; 0; j &lt; n; j++) &#123;\n      let k &#x3D; (i + j) % n;\n      left &#x3D; left + gas[k] - cost[k];\n      if (left &lt; 0) break;\n    &#125;\n\n    if (j &#x3D;&#x3D; n) return i;\n    else i +&#x3D; j + 1;\n  &#125;\n  return -1;\n&#125;;\n\n135 åˆ†å‘ç³–æœåˆ†æ\nf[i]è¡¨ç¤ºæ¯ä¸ªå­©å­åˆ†åˆ°çš„ç³–æœï¼Œans = f[0] +f[1] +â€¦.+ f[n]ã€‚æ¯ä¸ªå­©å­æœ€å°‘åˆ†åˆ° 1 ä¸ªç³–æœã€‚æŠŠå°æœ‹å‹çš„ç§¯åˆ†æƒ³è±¡æˆä¸€ä¸ªå°é˜¶ï¼Œåªè¦æ˜¯ä½ çš„å°é˜¶æ•°åˆ«ä¸¤è¾¹çš„é«˜ï¼Œä½ çš„ç³–æœæ•°ç›®å¿…é¡»æœ€å¤§ä¸€éå¤šä¸€ä¸ªæ‰èƒ½ä¿è¯æœ€å°‘ã€‚è€Œä¸”æœ€å°‘çš„åªæœ‰ä¸€ä¸ªã€‚\n\né¢˜è§£&#x2F;**\n * @param &#123;number[]&#125; ratings\n * @return &#123;number&#125;\n *&#x2F;\nvar candy &#x3D; function (ratings) &#123;\n  let n &#x3D; ratings.length;\n  let f &#x3D; new Array(n).fill(-1);\n  let w &#x3D; ratings;\n  let ans &#x3D; 0;\n\n  for (let x &#x3D; 0; x &lt; n; x++) &#123;\n    ans +&#x3D; dp(x);\n  &#125;\n\n  return ans;\n\n  function dp(i) &#123;\n    if (f[i] !&#x3D;&#x3D; -1) return f[i]; &#x2F;&#x2F; åˆ†è¿‡äº†ç³–æœä¸éœ€è¦å†åˆ†\n\n    f[i] &#x3D; 1;\n    if (i &amp;&amp; w[i - 1] &lt; w[i]) f[i] &#x3D; Math.max(f[i], dp(i - 1) + 1);\n    if (i + 1 &lt; n &amp;&amp; w[i + 1] &lt; w[i]) f[i] &#x3D; Math.max(f[i], dp(i + 1) + 1);\n\n    return f[i];\n  &#125;\n&#125;;\n\n136 åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—åˆ†æ\nä¸»è¦æ˜¯è¿ç”¨äº†ä½æ“ä½œçš„å¼‚æˆ–è¿ç®— a^a^b = a^b^a = b\n\né¢˜è§£&#x2F;**\n * @param &#123;number[]&#125; nums\n * @return &#123;number&#125;\n *&#x2F;\nvar singleNumber &#x3D; function (nums) &#123;\n  for (let i &#x3D; 1; i &lt; nums.length; i++) &#123;\n    nums[0] ^&#x3D; nums[i];\n  &#125;\n  return nums[0];\n&#125;;\n\n137 åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— IIåˆ†æ\nç”¨æ•°ç»„è®¡æ•°çš„æ–¹æ³•ä½¿ç”¨ä½è¿ç®—çš„æ“ä½œ ä½è¿ç®— å¹¶è¡Œè¿ç®—DFA æ€è·¯\n\né¢˜è§£ 1&#x2F;**\n * @param &#123;number[]&#125; nums\n * @return &#123;number&#125;\n *&#x2F;\nvar singleNumber &#x3D; function (nums) &#123;\n  let res &#x3D; &#123;&#125;;\n\n  nums.reduce((obj, key) &#x3D;&gt; &#123;\n    return obj[key]++ || (obj[key] &#x3D; 1), obj;\n  &#125;, res);\n\n  for (let key in res) &#123;\n    if (res[key] &#x3D;&#x3D;&#x3D; 1) &#123;\n      return key;\n    &#125;\n  &#125;\n&#125;;\n\né¢˜è§£ 2&#x2F;**\n * @param &#123;number[]&#125; nums\n * @return &#123;number&#125;\n *&#x2F;\nvar singleNumber &#x3D; function (nums) &#123;\n  &#x2F;&#x2F; let one &#x3D; 0, two &#x3D; 0;\n  let ans &#x3D; 0;\n  for (let i &#x3D; 0; i &lt; 32; i++) &#123;\n    let count &#x3D; 0;\n    for (let j &#x3D; 0; j &lt; nums.length; j++) &#123;\n      count +&#x3D; (nums[j] &gt;&gt; i) &amp; 1;\n    &#125;\n    ans +&#x3D; count % 3 &lt;&lt; i;\n  &#125;\n\n  return ans;\n&#125;;\n&#x2F;&#x2F; ç»Ÿè®¡æ¯ä¸€ä½ æ˜¯0æˆ–è€…æ˜¯1\n\né¢˜è§£ 3&#x2F;**\n * @param &#123;number[]&#125; nums\n * @return &#123;number&#125;\n *&#x2F;\nvar singleNumber &#x3D; function (nums) &#123;\n  &#x2F;&#x2F; let one &#x3D; 0, two &#x3D; 0;\n  let onceseen &#x3D; 0,\n    secondseen &#x3D; 0;\n  for (let x of nums) &#123;\n    onceseen &#x3D; ~secondseen &amp; (onceseen ^ x);\n    secondseen &#x3D; ~onceseen &amp; (secondseen ^ x);\n  &#125;\n  return onceseen;\n&#125;;\n\n138 å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨åˆ†æ\né¢˜è§£&#x2F;**\n * Definition for a Node.\n * function Node(val, next, random) &#123;\n *    this.val &#x3D; val;\n *    this.next &#x3D; next;\n *    this.random &#x3D; random;\n * &#125;;\n *&#x2F;\n\n&#x2F;**\n * @param &#123;Node&#125; head\n * @return &#123;Node&#125;\n *&#x2F;\nvar copyRandomList &#x3D; function (head) &#123;\n  let p &#x3D; head;\n  while (p) &#123;\n    &#x2F;&#x2F; å¤åˆ¶å°å¼Ÿ\n    let q &#x3D; new Node(p.val);\n    q.next &#x3D; p.next;\n    p.next &#x3D; q;\n    p &#x3D; q.next;\n  &#125;\n  &#x2F;&#x2F; å¤åˆ¶éšæœºçš„è¾¹\n  for (let p &#x3D; head; p; p &#x3D; p.next.next) &#123;\n    if (p.random) &#123;\n      p.next.random &#x3D; p.random.next;\n    &#125;\n  &#125;\n\n  &#x2F;&#x2F; æ‹†åˆ†é“¾è¡¨\n  let dummy &#x3D; new Node(-1),\n    cur &#x3D; dummy;\n\n  for (let p &#x3D; head; p; p &#x3D; p.next) &#123;\n    let q &#x3D; p.next; &#x2F;&#x2F; å°å¼Ÿ\n    cur &#x3D; cur.next &#x3D; q;\n    p.next &#x3D; q.next;\n  &#125;\n\n  return dummy.next;\n&#125;;\n\n142. ç¯å½¢é“¾è¡¨ IIåˆ†æ\na = c + (n-1) (b+c)\né¢˜è§£var detectCycle &#x3D; function (head) &#123;\n  if (head &#x3D;&#x3D;&#x3D; null) &#123;\n    return null;\n  &#125;\n  let slow &#x3D; head,\n    fast &#x3D; head;\n  while (fast !&#x3D;&#x3D; null) &#123;\n    slow &#x3D; slow.next;\n    if (fast.next !&#x3D;&#x3D; null) &#123;\n      fast &#x3D; fast.next.next;\n    &#125; else &#123;\n      return null;\n    &#125;\n    if (fast &#x3D;&#x3D;&#x3D; slow) &#123;\n      let ptr &#x3D; head;\n      while (ptr !&#x3D;&#x3D; slow) &#123;\n        ptr &#x3D; ptr.next;\n        slow &#x3D; slow.next;\n      &#125;\n      return ptr;\n    &#125;\n  &#125;\n  return null;\n&#125;;\n","slug":"LeetCode","date":"2021-04-06T14:27:28.256Z","categories_index":"leetcode","tags_index":"leetcode","author_index":"éº¦å½“"}]